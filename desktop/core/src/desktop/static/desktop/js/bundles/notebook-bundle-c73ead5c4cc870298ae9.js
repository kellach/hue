/*!
 * 
 * Licensed to Cloudera, Inc. under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  Cloudera, Inc. licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 * 
 * http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * 
 */!function(e){function t(t){for(var s,i,r=t[0],l=t[1],u=t[2],d=0,p=[];d<r.length;d++)i=r[d],o[i]&&p.push(o[i][0]),o[i]=0;for(s in l)Object.prototype.hasOwnProperty.call(l,s)&&(e[s]=l[s]);for(c&&c(t);p.length;)p.shift()();return n.push.apply(n,u||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],s=!0,r=1;r<a.length;r++){var l=a[r];0!==o[l]&&(s=!1)}s&&(n.splice(t--,1),e=i(i.s=a[0]))}return e}var s={},o={notebook:0},n=[];function i(t){if(s[t])return s[t].exports;var a=s[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=s,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(a,s,function(t){return e[t]}.bind(null,s));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var r=window.webpackJsonp=window.webpackJsonp||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var u=0;u<r.length;u++)t(r[u]);var c=l;n.push([1,"vendors~hue~notebook","vendors~notebook","hue~notebook"]),a()}({"./desktop/core/src/desktop/js/apps/notebook/notebook.js":
/*!***************************************************************!*\
  !*** ./desktop/core/src/desktop/js/apps/notebook/notebook.js ***!
  \***************************************************************/
/*! no exports provided */function(e,t,a){"use strict";a.r(t);a(/*! ext/bootstrap-datepicker.min */"./desktop/core/src/desktop/js/ext/bootstrap-datepicker.min.js"),a(/*! jquery/plugins/jquery.hdfstree */"./desktop/core/src/desktop/js/jquery/plugins/jquery.hdfstree.js");var s=a(/*! clipboard */"./node_modules/clipboard/lib/clipboard.js"),o=a.n(s),n=a(/*! apps/notebook/notebook.ko */"./desktop/core/src/desktop/js/apps/notebook/notebook.ko.js");window.Clipboard=o.a,window.EditorViewModel=n.default},"./desktop/core/src/desktop/js/apps/notebook/notebook.ko.js":
/*!******************************************************************!*\
  !*** ./desktop/core/src/desktop/js/apps/notebook/notebook.ko.js ***!
  \******************************************************************/
/*! exports provided: default */function(e,t,a){"use strict";a.r(t);var s=a(/*! jquery */"./node_modules/jquery/dist/jquery.js"),o=a.n(s),n=a(/*! knockout */"./node_modules/knockout/build/output/knockout-latest.debug.js"),i=a.n(n),r=a(/*! knockout.mapping */"./node_modules/knockout.mapping/knockout.mapping.js"),l=a.n(r),u=a(/*! api/apiHelper */"./desktop/core/src/desktop/js/api/apiHelper.js"),c=a(/*! utils/huePubSub */"./desktop/core/src/desktop/js/utils/huePubSub.js"),d=a(/*! utils/hueUtils */"./desktop/core/src/desktop/js/utils/hueUtils.js");function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var h={ignore:["ace","aceMode","autocompleter","availableDatabases","availableSnippets","avoidClosing","canWrite","cleanedDateTimeMeta","cleanedMeta","cleanedNumericMeta","cleanedStringMeta","dependents","errorLoadingQueries","hasProperties","history","images","inFocus","queries","saveResultsModalVisible","selectedStatement","snippetImage","user","positionStatement","lastExecutedStatement","downloadResultViewModel"]},m={teradata:{name:"Teradata",value:"teradata"},oracle:{name:"Oracle",value:"oracle"},netezza:{name:"Netezza",value:"netezza"},impala:{name:"Impala",value:"impala"},hive:{name:"Hive",value:"hive"},db2:{name:"DB2",value:"db2"},greenplum:{name:"Greenplum",value:"greenplum"},mysql:{name:"MySQL",value:"mysql"},postgresql:{name:"PostgreSQL",value:"postgresql"},informix:{name:"Informix",value:"informix"},sqlserver:{name:"SQL Server",value:"sqlserver"},sybase:{name:"Sybase",value:"sybase"},access:{name:"Access",value:"access"},firebird:{name:"Firebird",value:"firebird"},ansisql:{name:"ANSISQL",value:"ansisql"},generic:{name:"Generic",value:"generic"}},b={impala:{name:"Impala",value:"impala"},hive:{name:"Hive",value:"hive"}},f=function(e,t){var a=this;o.a.extend(e,"lines"==e.chartType&&{chartType:"bars",chartTimelineType:"line"}),a.id=i.a.observable(void 0!==t.id&&null!=t.id?t.id:d.default.UUID()),a.type=i.a.observable(void 0!==t.type&&null!=t.type?t.type:"table"),a.hasResultset=i.a.observable(void 0===t.hasResultset||null==t.hasResultset||t.hasResultset).extend("throttle",100),a.handle=i.a.observable(void 0!==t.handle&&null!=t.handle?t.handle:{}),a.meta=i.a.observableArray(void 0!==t.meta&&null!=t.meta?t.meta:[]);var s=function(){var e=0;a.meta().forEach(function(t){void 0===t.checked&&(t.checked=i.a.observable(!0),t.checked.subscribe(function(){a.filteredMetaChecked(a.filteredMeta().some(function(e){return e.checked()}))})),t.type=t.type.replace(/_type/i,"").toLowerCase(),void 0===t.originalIndex&&(t.originalIndex=e),e++})};function n(e){return o.a.inArray(e,["tinyint","smallint","int","bigint","float","double","decimal","real"])>-1}function r(e){return o.a.inArray(e,["timestamp","date","datetime"])>-1}function l(e){return!n(e)&&!r(e)&&!function(e){return o.a.inArray(e,["array","map","struct"])>-1}(e)}s(),a.meta.subscribe(s),a.rows=i.a.observable(void 0!==t.rows&&null!=t.rows?t.rows:null),a.hasMore=i.a.observable(void 0!==t.hasMore&&null!=t.hasMore&&t.hasMore),a.statement_id=i.a.observable(void 0!==t.statement_id&&null!=t.statement_id?t.statement_id:0),a.statement_range=i.a.observable(void 0!==t.statement_range&&null!=t.statement_range?t.statement_range:{start:{row:0,column:0},end:{row:0,column:0}}),a.statements_count=i.a.observable(1),a.previous_statement_hash=i.a.observable(void 0!==t.previous_statement_hash&&null!=t.previous_statement_hash?t.previous_statement_hash:null),a.cleanedMeta=i.a.computed(function(){return i.a.utils.arrayFilter(a.meta(),function(e){return""!=e.name})}),a.metaFilter=i.a.observable(),a.isMetaFilterVisible=i.a.observable(!1),a.filteredMetaChecked=i.a.observable(!0),a.filteredMeta=i.a.pureComputed(function(){return a.metaFilter()&&""!==a.metaFilter().query?a.meta().filter(function(e){var t=a.metaFilter().facets,s=!t||0===Object.keys(t).length||!t.type,o=!a.metaFilter().text||0===a.metaFilter().text.length,n=!0;return s||(n=!!t.type[e.type]),n&&!o&&(n=a.metaFilter().text.every(function(t){return-1!==e.name.toLowerCase().indexOf(t.toLowerCase())})),n}):a.meta()}),a.autocompleteFromEntries=function(e,t){var s=[],o=t.toLowerCase();return a.meta().forEach(function(a){0===a.name.toLowerCase().indexOf(o)?s.push(e+t+a.name.substring(t.length)):-1!==a.name.toLowerCase().indexOf("."+o)&&s.push(e+t+a.name.substring(t.length+a.name.toLowerCase().indexOf("."+o)+1))}),s},a.clickFilteredMetaCheck=function(){a.filteredMeta().forEach(function(e){e.checked(a.filteredMetaChecked())})},a.fetchedOnce=i.a.observable(void 0!==t.fetchedOnce&&null!=t.fetchedOnce&&t.fetchedOnce),a.startTime=i.a.observable(void 0!==t.startTime&&null!=t.startTime?new Date(t.startTime):new Date),a.endTime=i.a.observable(void 0!==t.endTime&&null!=t.endTime?new Date(t.endTime):new Date),a.executionTime=i.a.computed(function(){return a.endTime().getTime()-a.startTime().getTime()}),a.cleanedNumericMeta=i.a.computed(function(){return i.a.utils.arrayFilter(a.meta(),function(e){return""!=e.name&&n(e.type)})}),a.cleanedStringMeta=i.a.computed(function(){return i.a.utils.arrayFilter(a.meta(),function(e){return""!=e.name&&l(e.type)})}),a.cleanedDateTimeMeta=i.a.computed(function(){return i.a.utils.arrayFilter(a.meta(),function(e){return""!=e.name&&r(e.type)})}),a.data=i.a.observableArray(void 0!==t.data&&null!=t.data?t.data:[]),a.data.extend({rateLimit:50}),a.explanation=i.a.observable(void 0!==t.explanation&&null!=t.explanation?t.explanation:""),a.images=i.a.observableArray(void 0!==t.images&&null!=t.images?t.images:[]),a.images.extend({rateLimit:50}),a.logs=i.a.observable(""),a.logLines=0,a.hasSomeResults=i.a.computed(function(){return a.hasResultset()&&a.data().length>0}),a.getContext=function(){return{id:a.id,type:a.type,handle:a.handle}},a.clear=function(){a.fetchedOnce(!1),a.hasMore(!1),a.statement_range({start:{row:0,column:0},end:{row:0,column:0}}),a.meta.removeAll(),a.data.removeAll(),a.images.removeAll(),a.logs(""),a.handle({has_more_statements:a.handle().has_more_statements,statement_id:a.handle().statement_id,statements_count:a.handle().statements_count,previous_statement_hash:a.handle().previous_statement_hash}),a.startTime(new Date),a.endTime(new Date),a.explanation(""),a.logLines=0,a.rows(null)}};f.prototype.cancelBatchExecution=function(){this.statements_count(1),this.hasMore(!1),this.statement_range({start:{row:0,column:0},end:{row:0,column:0}}),this.handle().statement_id=0,this.handle().start={row:0,column:0},this.handle().end={row:0,column:0},this.handle().has_more_statements=!1,this.handle().previous_statement_hash=""};var g=function(e){var t={};return"jar"!=e&&"py"!=e||(t.driverCores="",t.executorCores="",t.numExecutors="",t.queue="",t.archives=[],t.files=[]),"java"==e&&(t.archives=[],t.files=[],t.capture_output=!1),"shell"==e&&(t.archives=[],t.files=[]),"mapreduce"==e&&(t.app_jar="",t.hadoopProperties=[],t.jars=[],t.files=[],t.archives=[]),"spark2"==e&&(t.app_name="",t.class="",t.jars=[],t.spark_opts=[],t.spark_arguments=[],t.files=[]),"sqoop1"==e&&(t.files=[]),"jar"==e||"java"==e?(t.app_jar="",t.class="",t.arguments=[]):"distcp"==e?(t.source_path="",t.destination_path=""):"shell"==e?(t.command_path="",t.arguments=[],t.env_var=[],t.capture_output=!0):"py"==e?(t.py_file="",t.arguments=[]):"hive"==e?(t.settings=[],t.files=[],t.functions=[],t.arguments=[]):"impala"==e?t.settings=[]:"pig"==e&&(t.parameters=[],t.hadoopProperties=[],t.resources=[]),t},v=/line ([0-9]+)(\:([0-9]+))?/i,y=function(e,t,a){var s=this;s.id=i.a.observable(void 0!==a.id&&null!=a.id?a.id:d.default.UUID()),s.name=i.a.observable(void 0!==a.name&&null!=a.name?a.name:""),s.type=i.a.observable(void 0!==a.type&&null!=a.type?a.type:"hive"),s.type.subscribe(function(e){s.status("ready")}),s.isBatchable=i.a.computed(function(){return"hive"==s.type()||"impala"==s.type()||o.a.grep(e.availableLanguages,function(e){return e.type==s.type()&&"oozie"==e.interface}).length>0}),s.autocompleteSettings={temporaryOnly:!1},s.aceCursorPosition=i.a.observable(t.isHistory()?a.aceCursorPosition:null);var n=null;s.ace=function(e){return e&&(n=e,t.isPresentationMode()||n.focus()),n},s.errors=i.a.observableArray([]),s.aceErrorsHolder=i.a.observableArray([]),s.aceWarningsHolder=i.a.observableArray([]),s.aceErrors=i.a.pureComputed(function(){return s.showOptimizer()?s.aceErrorsHolder():[]}),s.aceWarnings=i.a.pureComputed(function(){return s.showOptimizer()?s.aceWarningsHolder():[]}),s.availableSnippets=e.availableSnippets(),s.inFocus=i.a.observable(!1),s.inFocus.subscribe(function(e){e&&c.default.publish("active.snippet.type.changed",s.type())}),s.editorMode=e.editorMode,s.getAceMode=function(){return e.getSnippetViewSettings(s.type()).aceMode},s.dbSelectionVisible=i.a.observable(!1),s.showExecutionAnalysis=i.a.observable(!1),s.isSqlDialect=i.a.pureComputed(function(){return e.getSnippetViewSettings(s.type()).sqlDialect}),s.getPlaceHolder=function(){return e.getSnippetViewSettings(s.type()).placeHolder},s.getApiHelper=function(){return u.default},s.namespace=i.a.observable(a.namespace&&a.namespace.id?a.namespace:void 0),s.compute=i.a.observable(a.compute&&a.compute.id?a.compute:void 0),s.whenContextSet=function(){var e,t,a=o.a.Deferred();s.namespace()?a.resolve(s.namespace()):e=s.namespace.subscribe(function(t){t&&(a.resolve(t),e.dispose())});var n=o.a.Deferred();s.compute()?n.resolve(s.compute()):t=s.compute.subscribe(function(e){e&&(n.resolve(e),t.dispose())});var i=o.a.when(a,n);return i.dispose=function(){e&&e.dispose(),t&&t.dispose(),a.reject(),n.reject()},i},s.availableDatabases=i.a.observableArray(),s.database=i.a.observable();var r=null;s.database.subscribe(function(e){null!==e&&(u.default.setInTotalStorage("editor","last.selected.database",e),null!==r&&r!==e&&c.default.publish("editor.refresh.statement.locations",s),r=e)}),s.database(void 0!==a.database&&null!=a.database?a.database:null),s.currentQueryTab=i.a.observable(void 0!==a.currentQueryTab&&null!=a.currentQueryTab?a.currentQueryTab:"queryHistory"),s.pinnedContextTabs=i.a.observableArray(void 0!==a.pinnedContextTabs&&null!=a.pinnedContextTabs?a.pinnedContextTabs:[]),s.removeContextTab=function(e){e.tabId===s.currentQueryTab()&&s.currentQueryTab("queryHistory"),s.pinnedContextTabs.remove(e)},s.errorLoadingQueries=i.a.observable(!1),s.loadingQueries=i.a.observable(!1),s.queriesHasErrors=i.a.observable(!1),s.queriesCurrentPage=i.a.observable(e.selectedNotebook()&&e.selectedNotebook().snippets().length>0?e.selectedNotebook().snippets()[0].queriesCurrentPage():1),s.queriesTotalPages=i.a.observable(e.selectedNotebook()&&e.selectedNotebook().snippets().length>0?e.selectedNotebook().snippets()[0].queriesTotalPages():1),s.queries=i.a.observableArray([]),s.queriesFilter=i.a.observable(""),s.queriesFilterVisible=i.a.observable(!1),s.queriesFilter.extend({rateLimit:{method:"notifyWhenChangesStop",timeout:900}}),s.queriesFilter.subscribe(function(e){s.fetchQueries()});var y=null;s.fetchQueries=function(){u.default.cancelActiveRequest(y);w=s.queriesCurrentPage(),s.loadingQueries(!0),s.queriesHasErrors(!1),y=u.default.searchDocuments({successCallback:function(e){s.queriesTotalPages(Math.ceil(e.count/50)),s.queries(l.a.fromJS(e.documents)()),s.loadingQueries(!1),s.queriesHasErrors(!1)},errorCallback:function(){s.loadingQueries(!1),s.queriesHasErrors(!0)},page:s.queriesCurrentPage(),limit:50,type:"query-"+s.type(),query:s.queriesFilter(),include_trashed:!1})};var w=1;s.currentQueryTab.subscribe(function(e){c.default.publish("redraw.fixed.headers"),c.default.publish("tab.switched",e),"savedQueries"!==e||0!==s.queries().length&&w===s.queriesCurrentPage()||s.fetchQueries()}),s.prevQueriesPage=function(){1!==s.queriesCurrentPage()&&(s.queriesCurrentPage(s.queriesCurrentPage()-1),s.fetchQueries())},s.nextQueriesPage=function(){s.queriesCurrentPage()!==s.queriesTotalPages()&&(s.queriesCurrentPage(s.queriesCurrentPage()+1),s.fetchQueries())},c.default.subscribeOnce("assist.source.set",function(e){e!==s.type()&&c.default.publish("assist.set.source",s.type())},e.huePubSubId),c.default.publish("assist.get.source");var x=!1;s.handleAssistSelection=function(e){x?x=!1:e.sourceType===s.type()&&(s.namespace()!==e.namespace&&s.namespace(e.namespace),s.database()!==e.name&&s.database(e.name))},s.database()||c.default.publish("assist.get.database.callback",{source:s.type(),callback:function(e){s.handleAssistSelection(e)}}),s.statementType=i.a.observable(void 0!==a.statementType&&null!=a.statementType?a.statementType:"text"),s.statementTypes=i.a.observableArray(["text","file"]),e.editorMode()||s.statementTypes.push("document"),s.statementPath=i.a.observable(void 0!==a.statementPath&&null!=a.statementPath?a.statementPath:""),s.statementPath.subscribe(function(e){s.getExternalStatement()}),s.externalStatementLoaded=i.a.observable(!1),s.getExternalStatement=function(){s.externalStatementLoaded(!1),o.a.post("/notebook/api/get_external_statement",{notebook:l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext())},function(e){0==e.status?(s.externalStatementLoaded(!0),s.statement_raw(e.statement),s.ace().setValue(s.statement_raw(),1)):s._ajaxError(e)})},s.associatedDocumentLoading=i.a.observable(!0),s.associatedDocument=i.a.observable(),s.associatedDocumentUuid=i.a.observable(void 0!==a.associatedDocumentUuid&&null!=a.associatedDocumentUuid?a.associatedDocumentUuid:null),s.associatedDocumentUuid.subscribe(function(e){""!==e?s.getExternalStatement():(s.statement_raw(""),s.ace().setValue("",1))}),s.statement_raw=i.a.observable(void 0!==a.statement_raw&&null!=a.statement_raw?a.statement_raw:""),s.selectedStatement=i.a.observable(""),s.positionStatement=i.a.observable(null),s.lastExecutedStatement=i.a.observable(null),s.statementsList=i.a.observableArray(),c.default.subscribe("editor.active.statement.changed",function(e){if(s.ace()&&s.ace().container.id===e.id){if(e.activeStatement?s.positionStatement(e.activeStatement):s.positionStatement(null),e.activeStatement){var a=[];e.precedingStatements.forEach(function(e){a.push(e.statement)}),a.push(e.activeStatement.statement),e.followingStatements.forEach(function(e){a.push(e.statement)}),s.statementsList(a)}else s.statementsList([]);t.isPresentationModeInitialized()||(t.isPresentationModeDefault()&&s.status("ready"),t.isPresentationModeInitialized(!0),t.isPresentationMode(t.isPresentationModeDefault()))}},e.huePubSubId),s.aceSize=i.a.observable(void 0!==a.aceSize&&null!=a.aceSize?a.aceSize:100),s.status=i.a.observable(void 0!==a.status&&null!=a.status?a.status:"loading"),s.statusForButtons=i.a.observable("executed"),s.properties=i.a.observable(l.a.fromJS(void 0!==a.properties&&null!=a.properties?a.properties:g(s.type()))),s.hasProperties=i.a.computed(function(){return Object.keys(l.a.toJS(s.properties())).length>0}),s.viewSettings=i.a.computed(function(){return e.getSnippetViewSettings(s.type())});var T={};s.type.subscribe(function(e){T[e]=s.properties()},null,"beforeChange"),s.type.subscribe(function(e){void 0!==T[e]?s.properties(T[e]):s.properties(l.a.fromJS(g(e))),s.result.clear(),window.setTimeout(function(){null!==s.ace()&&s.ace().focus()},100)}),a.variables&&a.variables.forEach(function(e){e.meta="object"===p(e.defaultValue)&&e.defaultValue||{type:"text",placeholder:""},e.value=e.value||"",e.type=e.type||"text",e.sample=[],e.sampleUser=e.sampleUser||[],e.path=e.path||"",e.step="",delete e.defaultValue}),s.variables=l.a.fromJS(void 0!==a.variables&&null!=a.variables?a.variables:[]),s.variables.subscribe(function(e){o()(document).trigger("updateResultHeaders",s)}),s.hasCurlyBracketParameters=i.a.computed(function(){return"pig"!=s.type()}),s.getPigParameters=function(){var e={},t=s.statement_raw().match(/([^\\]|^)\$[^\d'"](\w*)/g),a=s.statement_raw().match(/%declare +([^ ])+/gi),n=s.statement_raw().match(/%default +([^;])+/gi),i=s.statement_raw().match(/define [^ ]+ *\(([^\)]*)\)/gi),r=s.statement_raw().match(/returns +([^\{]*)/gi);return t&&o.a.each(t,function(t,a){var s=a.substring(a.indexOf("$")+1);e[s]=""}),a&&o.a.each(a,function(t,a){(a=a.match(/(\w+)/g))&&a.length>=2&&delete e[a[1]]}),n&&o.a.each(n,function(t,a){var s=a.match(/(\w+)/g);if(s&&s.length>=2){var o=s[1];e[o]=a.substring(a.indexOf(o)+o.length+1)}}),i&&o.a.each(i,function(t,a){var s=a.match(/(\w+)/g);s&&s.length>2&&o.a.each(s,function(t,a){t>=2&&delete e[a]})}),r&&o.a.each(r,function(t,a){var s=a.match(/(\w+)/g);s&&o.a.each(s,function(t,a){t>=1&&delete e[a]})}),e},s.variableNames=i.a.computed(function(){var e,t,a={};if("pig"==s.type())a=s.getPigParameters();else for(var n=/(?:^|\W)\${(\w*)\=?([^{}]*)}/g,i=/(^\s*--.*)|(\/\*[\s\S]*?\*\/)/gm,r=/(?!\s*$)\s*(?:(?:([^,|()\\]*)\(\s*([^,|()\\]*)\)(?:\\[\S\s][^,|()\\]*)?)|([^,|\\]*(?:\\[\S\s][^,|\\]*)*))\s*(?:,|\||$)/g,l=s.statement_raw(),u=i.exec(l),c=function(){for(;u&&e.index>u.index+u[0].length;)u=i.exec(l);if(u&&e.index>=u.index)return"continue";for(var s={type:"text",placeholder:""};t=r.exec(e[2]);){var o={text:t[2]||t[3],value:t[3]||t[1]};o.text=o.text&&o.text.trim(),o.value=o.value&&o.value.trim().replace(",",",").replace("(","(").replace(")",")"),(s.placeholder||t[2])&&(s.options||(s.options=[],s.type="select"),s.options.push(o)),s.placeholder||(s.placeholder=o.value)}!s.options||s.options.some(function(e){return e.value==s.placeholder})||s.options.unshift({text:s.placeholder,value:s.placeholder}),a[e[1]]=a[e[1]]||s};e=n.exec(l);)c();return o.a.map(a,function(e,t){return{name:t,meta:"object"===p(a[t])?a[t]:{type:"text",placeholder:a[t]}}})}),s.variableValues={},s.variableNames.extend({rateLimit:150}),s.variableNames.subscribe(function(e){var t=s.variables().length-e.length,a=t<0,o=t>0;if(s.variableValues=s.variables().reduce(function(e,t){return e[t.name()]||(e[t.name()]={sampleUser:[]}),e[t.name()].value=t.value(),e[t.name()].sampleUser=t.sampleUser(),e[t.name()].catalogEntry=t.catalogEntry,e[t.name()].path=t.path(),e[t.name()].type=t.type(),e},s.variableValues),a)for(var n=0,i=Math.abs(t);n<i;n++)s.variables.push(l.a.fromJS({name:"",value:"",meta:{type:"text",placeholder:"",options:[]},sample:[],sampleUser:[],type:"text",step:"",path:""}));else o&&s.variables.splice(s.variables().length-t,t);e.forEach(function(e,t){var o=s.variables()[t];o.name(e.name),setTimeout(function(){o.value(s.variableValues[e.name]?s.variableValues[e.name].value:!a&&o.value()||"")},0),o.meta=l.a.fromJS(e.meta,{},o.meta),o.sample(o.meta.options?o.meta.options().concat(o.sampleUser()):o.sampleUser()),o.sampleUser(s.variableValues[e.name]?s.variableValues[e.name].sampleUser:[]),o.type(s.variableValues[e.name]&&s.variableValues[e.name].type||"text"),o.path(s.variableValues[e.name]&&s.variableValues[e.name].path||""),o.catalogEntry=s.variableValues[e.name]&&s.variableValues[e.name].catalogEntry})});var k=[];c.default.subscribe("ace.sql.location.worker.message",function(e){for(;k.length;){var t=k.pop();t.cancel&&t.cancel()}s.type();var a=e.data.locations.filter(function(e){return"variable"===e.type&&e.colRef}).reduce(function(e,t){return e[/\${(\w*)\=?([^{}]*)}/g.exec(t.value)[1]]=t,e},{}),o=function(e,t){var a;a=t&&t.type?t.type.toLowerCase():"string";var s={},o=e.value();switch(a){case"timestamp":s.type="datetime-local",s.step="1",s.value=o&&moment.utc(o).format("YYYY-MM-DD HH:mm:ss.S")||moment(Date.now()).format("YYYY-MM-DD 00:00:00.0");break;case"decimal":case"double":case"float":s.type="number",s.step="any";break;case"int":case"smallint":case"tinyint":case"bigint":s.type="number",s.step="1";break;case"date":s.type="date",s.step="",s.value=o&&moment.utc(o).format("YYYY-MM-DD")||moment(Date.now()).format("YYYY-MM-DD");break;case"boolean":s.type="checkbox",s.step="";break;default:s.type="text",s.step=""}s.value&&setTimeout(function(){e.value(s.value)},0),e.type(s.type),e.step(s.step)};s.variables().forEach(function(e){a[e.name()]?k.push(a[e.name()].resolveCatalogEntry({cancellable:!0}).done(function(t){e.path(t.path.join(".")),e.catalogEntry=t,k.push(t.getSourceMeta({silenceErrors:!0,cancellable:!0}).then(o.bind(s,e)))})):o(e,{type:"text"})})}),s.statement=i.a.computed(function(){var e=s.isSqlDialect()?s.selectedStatement()?s.selectedStatement():null!==s.positionStatement()?s.positionStatement().statement:s.statement_raw():s.statement_raw(),t=s.variables().reduce(function(e,t){return e[t.name()]=t,e},{});if(s.variables().length){var a=s.variables().map(function(e){return e.name()}).join("|");e=e.replace(RegExp("([^\\\\])?\\$"+(s.hasCurlyBracketParameters()?"{(":"(")+a+")(=[^}]*)?"+(s.hasCurlyBracketParameters()?"}":""),"g"),function(e,a,s){var o=t[s],n="datetime-local"==o.type()&&16==o.value().length?":00":"",i=o.value();return a+(null!=i?i+n:o.meta.placeholder&&o.meta.placeholder())})}return e}),s.result=new f(a,a.result),s.result.hasSomeResults()||s.currentQueryTab("queryHistory"),s.showGrid=i.a.observable(void 0===a.showGrid||null==a.showGrid||a.showGrid),s.showChart=i.a.observable(void 0!==a.showChart&&null!=a.showChart&&a.showChart);var _=!0;e.editorMode()&&o.a.totalStorage("hue.editor.showLogs")&&(_=o.a.totalStorage("hue.editor.showLogs")),s.showLogs=i.a.observable(void 0!==a.showLogs&&null!=a.showLogs?a.showLogs:_),s.progress=i.a.observable(void 0!==a.progress&&null!=a.progress?a.progress:0),s.jobs=i.a.observableArray(void 0!==a.jobs&&null!=a.jobs?a.jobs:[]),s.executeNextTimeout=-1;var M={};function C(){var e=s.chartType();if(hueAnalytics.log("notebook","chart/"+e),e===i.a.HUE_CHARTS.TYPES.MAP&&s.result.cleanedNumericMeta().length>=2){if(null===s.chartX()||void 0===s.chartX()){var t=s.result.cleanedNumericMeta()[0].name;s.result.cleanedNumericMeta().forEach(function(e){(e.name.toLowerCase().indexOf("lat")>-1||e.name.toLowerCase().indexOf("ltd")>-1)&&(t=e.name)}),s.chartX(t)}if(null===s.chartYSingle()||void 0===s.chartYSingle()){var a=s.result.cleanedNumericMeta()[1].name;s.result.cleanedNumericMeta().forEach(function(e){(e.name.toLowerCase().indexOf("lon")>-1||e.name.toLowerCase().indexOf("lng")>-1)&&(a=e.name)}),s.chartYSingle(a)}}else null!==s.chartX()&&void 0!==s.chartX()||e!=i.a.HUE_CHARTS.TYPES.BARCHART&&e!=i.a.HUE_CHARTS.TYPES.PIECHART&&e!=i.a.HUE_CHARTS.TYPES.GRADIENTMAP||!(s.result.cleanedStringMeta().length>=1)||s.chartX(s.result.cleanedStringMeta()[0].name),s.result.cleanedNumericMeta().length>0&&(0!==s.chartYMulti().length||e!==i.a.HUE_CHARTS.TYPES.BARCHART&&e!==i.a.HUE_CHARTS.TYPES.LINECHART?null!==s.chartYSingle()&&void 0!==s.chartYSingle()||e!==i.a.HUE_CHARTS.TYPES.PIECHART&&e!==i.a.HUE_CHARTS.TYPES.MAP&&e!==i.a.HUE_CHARTS.TYPES.GRADIENTMAP&&e!==i.a.HUE_CHARTS.TYPES.SCATTERCHART&&(e!==i.a.HUE_CHARTS.TYPES.BARCHART||null===s.chartXPivot())||(0===s.chartYMulti().length?s.chartYSingle(s.result.cleanedNumericMeta()[Math.min(s.result.cleanedNumericMeta().length-1,1)].name):s.chartYSingle(s.chartYMulti()[0])):s.chartYMulti.push(s.result.cleanedNumericMeta()[Math.min(s.result.cleanedNumericMeta().length-1,1)].name))}function E(e){var t=null;return e&&s.result.cleanedMeta().length>0&&s.result.cleanedMeta().forEach(function(a){a.name.toLowerCase()!==e.toLowerCase()&&e.toLowerCase()!==a.name.toLowerCase()||(t=a.name)}),t}if(s.onDdlExecute=function(){if(s.result.handle()&&s.result.handle().has_more_statements&&(window.clearTimeout(s.executeNextTimeout),s.executeNextTimeout=setTimeout(function(){s.execute(!0)},1e3)),s.lastExecutedStatement()&&/CREATE|DROP/i.test(s.lastExecutedStatement().firstToken)){var e=s.statement().match(/(?:CREATE|DROP)\s+TABLE\s+(?:IF\s+(?:NOT\s+)?EXISTS\s+)?(?:`([^`]+)`|([^;\s]+))\..*/i),t=[];e?t.push(e[1]||e[2]):(e=s.statement().match(/(?:CREATE|DROP)\s+(?:DATABASE|SCHEMA)\s+(?:IF\s+(?:NOT\s+)?EXISTS\s+)?(?:`([^`]+)`|([^;\s]+))/i))?t.push(e[1]||e[2]):s.database()&&t.push(s.database()),t.length&&(window.clearTimeout(M[t.join(".")]),M[t.join(".")]=window.setTimeout(function(){x=!0,dataCatalog.getEntry({sourceType:s.type(),namespace:s.namespace(),compute:s.compute(),path:t}).done(function(e){e.clearCache({invalidate:"invalidate",cascade:!0,silenceErrors:!0})})},5e3))}},s.progress.subscribe(function(e){o()(document).trigger("progress",{data:e,snippet:s})}),s.showGrid.subscribe(function(e){e&&(s.showChart(!1),c.default.publish("editor.grid.shown",s))}),s.showChart.subscribe(function(e){e&&(s.showGrid(!1),s.isResultSettingsVisible(!0),o()(document).trigger("forceChartDraw",s),c.default.publish("editor.chart.shown",s),C())}),s.showLogs.subscribe(function(t){c.default.publish("redraw.fixed.headers"),t&&s.getLogs(),e.editorMode()&&o.a.totalStorage("hue.editor.showLogs",t)}),s.isLoading=i.a.computed(function(){return"loading"==s.status()}),s.resultsKlass=i.a.computed(function(){return"results "+s.type()}),s.errorsKlass=i.a.computed(function(){return s.resultsKlass()+" alert alert-error"}),s.is_redacted=i.a.observable(void 0!==a.is_redacted&&null!=a.is_redacted&&a.is_redacted),s.chartType=i.a.observable(void 0!==a.chartType&&null!=a.chartType?a.chartType:i.a.HUE_CHARTS.TYPES.BARCHART),s.chartType.subscribe(C),s.chartSorting=i.a.observable(void 0!==a.chartSorting&&null!=a.chartSorting?a.chartSorting:"none"),s.chartScatterGroup=i.a.observable(void 0!==a.chartScatterGroup&&null!=a.chartScatterGroup?a.chartScatterGroup:null),s.chartScatterSize=i.a.observable(void 0!==a.chartScatterSize&&null!=a.chartScatterSize?a.chartScatterSize:null),s.chartScope=i.a.observable(void 0!==a.chartScope&&null!=a.chartScope?a.chartScope:"world"),s.chartTimelineType=i.a.observable(void 0!==a.chartTimelineType&&null!=a.chartTimelineType?a.chartTimelineType:"bar"),s.chartLimits=i.a.observableArray([5,10,25,50,100]),s.chartLimit=i.a.observable(void 0!==a.chartLimit&&null!=a.chartLimit?a.chartLimit:null),s.chartLimit.extend({notify:"always"}),s.chartX=i.a.observable(void 0!==a.chartX&&null!=a.chartX?a.chartX:null),s.chartX.extend({notify:"always"}),s.chartXPivot=i.a.observable(void 0!==a.chartXPivot&&null!=a.chartXPivot?a.chartXPivot:null),s.chartXPivot.extend({notify:"always"}),s.chartXPivot.subscribe(C),s.chartYSingle=i.a.observable(void 0!==a.chartYSingle&&null!=a.chartYSingle?a.chartYSingle:null),s.chartYMulti=i.a.observableArray(void 0!==a.chartYMulti&&null!=a.chartYMulti?a.chartYMulti:[]),s.chartData=i.a.observableArray(void 0!==a.chartData&&null!=a.chartData?a.chartData:[]),s.chartMapType=i.a.observable(void 0!==a.chartMapType&&null!=a.chartMapType?a.chartMapType:"marker"),s.chartMapLabel=i.a.observable(void 0!==a.chartMapLabel&&null!=a.chartMapLabel?a.chartMapLabel:null),s.chartMapHeat=i.a.observable(void 0!==a.chartMapHeat&&null!=a.chartMapHeat?a.chartMapHeat:null),s.hideStacked=i.a.computed(function(){return s.chartYMulti().length<=1}),s.hasDataForChart=i.a.computed(function(){return s.chartType()==i.a.HUE_CHARTS.TYPES.BARCHART||s.chartType()==i.a.HUE_CHARTS.TYPES.LINECHART||s.chartType()==i.a.HUE_CHARTS.TYPES.TIMELINECHART?void 0!==s.chartX()&&null!=s.chartX()&&s.chartYMulti().length>0:void 0!==s.chartX()&&null!=s.chartX()&&void 0!==s.chartYSingle()&&null!=s.chartYSingle()}),s.hasDataForChart.subscribe(function(e){s.chartX.notifySubscribers(),s.chartX.valueHasMutated()}),s.chartType.subscribe(function(e){o()(document).trigger("forceChartDraw",s)}),s.previousChartOptions={},s.result.meta.subscribe(function(e){var t,a;s.chartLimit(s.previousChartOptions.chartLimit),s.chartX(E(s.previousChartOptions.chartX)),s.chartXPivot(s.previousChartOptions.chartXPivot),s.chartYSingle(E(s.previousChartOptions.chartYSingle)),s.chartMapType(s.previousChartOptions.chartMapType),s.chartMapLabel(E(s.previousChartOptions.chartMapLabel)),s.chartMapHeat(s.previousChartOptions.chartMapHeat),s.chartYMulti((t=s.previousChartOptions.chartYMulti,a=[],t&&t.forEach(function(e){var t=E(e);t&&a.push(t)}),a||[])),s.chartSorting(s.previousChartOptions.chartSorting),s.chartScatterGroup(s.previousChartOptions.chartScatterGroup),s.chartScatterSize(s.previousChartOptions.chartScatterSize),s.chartScope(s.previousChartOptions.chartScope),s.chartTimelineType(s.previousChartOptions.chartTimelineType)}),s.isResultSettingsVisible=i.a.observable(void 0!==a.isResultSettingsVisible&&null!=a.isResultSettingsVisible&&a.isResultSettingsVisible),s.toggleResultSettings=function(){s.isResultSettingsVisible(!s.isResultSettingsVisible())},s.isResultSettingsVisible.subscribe(function(){o()(document).trigger("toggleResultSettings",s)}),s.settingsVisible=i.a.observable(void 0!==a.settingsVisible&&null!=a.settingsVisible&&a.settingsVisible),s.saveResultsModalVisible=i.a.observable(!1),s.checkStatusTimeout=null,s.getContext=function(){return{id:s.id,type:s.type,status:s.status,statementType:s.statementType,statement:s.statement,aceCursorPosition:s.aceCursorPosition,statementPath:s.statementPath,associatedDocumentUuid:s.associatedDocumentUuid,properties:s.properties,result:s.result.getContext(),database:s.database,compute:s.compute(),wasBatchExecuted:s.wasBatchExecuted()}},s.complexity=i.a.observable(),s.hasComplexity=i.a.pureComputed(function(){return s.complexity()&&Object.keys(s.complexity()).length>0}),s.hasRisks=i.a.pureComputed(function(){return s.hasComplexity()&&s.complexity().hints&&s.complexity().hints.length>0}),s.topRisk=i.a.pureComputed(function(){return s.hasRisks()?s.complexity().hints[0]:null}),s.suggestion=i.a.observable(""),s.hasSuggestion=i.a.observable(null),s.compatibilityCheckRunning=i.a.observable(!1),s.compatibilitySourcePlatforms=[],Object.keys(m).forEach(function(e){s.compatibilitySourcePlatforms.push(m[e])}),s.compatibilitySourcePlatform=i.a.observable(m[s.type()]),s.compatibilitySourcePlatform.subscribe(function(e){e&&e.value!==s.type()&&(s.hasSuggestion(null),s.compatibilityTargetPlatform(b[s.type()]),s.queryCompatibility())}),s.compatibilityTargetPlatforms=[],Object.keys(b).forEach(function(e){s.compatibilityTargetPlatforms.push(b[e])}),s.compatibilityTargetPlatform=i.a.observable(b[s.type()]),s.showOptimizer=i.a.observable(u.default.getFromTotalStorage("editor","show.optimizer",!1)),s.showOptimizer.subscribe(function(e){null!==e&&u.default.setInTotalStorage("editor","show.optimizer",e)}),HAS_OPTIMIZER&&!e.isNotificationManager()){var P,O,A=[];s.delayedStatement=i.a.pureComputed(s.statement).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:2e3}});var N=function(e){0==e.status?(s.hasSuggestion(""),s.complexity(e.query_complexity)):(s.hasSuggestion("error"),s.complexity({hints:[]})),c.default.publish("editor.active.risks",{editor:s.ace(),risks:s.complexity()||{}}),O=s.statement()},D=function(){null!==s.hasSuggestion()&&void 0!==s.hasSuggestion()&&s.hasSuggestion(null),""!==s.suggestion()&&s.suggestion(""),s.complexity()!=={}&&(s.complexity(void 0),c.default.publish("editor.active.risks",{editor:s.ace(),risks:{}}))};s.positionStatement.subscribe(function(e){if(e){var t=e.statement.hashCode();A.every(function(e){return e.hash!==t||(N(e.data),!1)})&&D()}}),s.checkComplexity=function(){if(s.inFocus()&&O!==s.statement()&&(!s.positionStatement()||!s.positionStatement().syntaxError)){u.default.cancelActiveRequest(P),hueAnalytics.log("notebook","get_query_risk"),D();var e=s.statement.subscribe(function(){e.dispose(),u.default.cancelActiveRequest(P)}),a=s.statement().hashCode();A.every(function(e){return e.hash!==a||(N(e.data),!1)})&&(P=o.a.ajax({type:"POST",url:"/notebook/api/optimizer/statement/risk",timeout:3e4,data:{notebook:l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext())},success:function(e){A.unshift({hash:a,data:e}),A.length>50&&A.pop(),N(e)},always:function(t){e.dispose()}}))}},"hive"!==s.type()&&"impala"!==s.type()||(s.statement_raw()&&window.setTimeout(function(){s.checkComplexity()},2e3),s.delayedStatement.subscribe(function(){s.checkComplexity()}))}s._ajaxError=function(a,n){if(-2==a.status){var i=t.getSession(s.type());i?t.restartSession(i,n):t.createSession(new S(e,{type:s.type()}),n)}else if(-3==a.status)s.status("expired"),a.message&&(s.errors.push({message:a.message,help:null,line:null,col:null}),c.default.publish("editor.snippet.result.normal",s));else if(-4==a.status)t.retryModalCancel=function(){s.status("failed"),c.default.publish("hide.retry.modal")},t.retryModalConfirm=function(){n&&n(),c.default.publish("hide.retry.modal")},c.default.publish("show.retry.modal");else if(401==a.status)s.status("expired"),o()(document).trigger("showAuthModal",{type:s.type(),callback:s.execute});else if(1==a.status||-1==a.status){s.status("failed");var r=v.exec(a.message);if(r){var l,u=parseInt(r[1]);void 0!==r[3]&&(l=parseInt(r[3])),s.positionStatement()&&(l&&1===u&&(l+=s.positionStatement().location.first_column),u+=s.positionStatement().location.first_line-1),s.errors.push({message:a.message.replace(r[0],"line "+u+(null!==l?":"+l:"")),help:null,line:u-1,col:l})}else s.errors.push({message:a.message,help:a.help,line:null,col:null})}else o()(document).trigger("error",a.message),s.status("failed")},s.wasBatchExecuted=i.a.observable(void 0!==a.wasBatchExecuted&&null!=a.wasBatchExecuted&&a.wasBatchExecuted),s.isReady=i.a.computed(function(){return"text"==s.statementType()&&(s.isSqlDialect()&&""!==s.statement()||-1==["jar","java","spark2","distcp"].indexOf(s.type())&&""!==s.statement()||-1!=["jar","java"].indexOf(s.type())&&""!=s.properties().app_jar()&&""!=s.properties().class()||-1!=["spark2"].indexOf(s.type())&&s.properties().jars().length>0||-1!=["shell"].indexOf(s.type())&&s.properties().command_path().length>0||-1!=["mapreduce"].indexOf(s.type())&&s.properties().app_jar().length>0||-1!=["distcp"].indexOf(s.type())&&s.properties().source_path().length>0&&s.properties().destination_path().length>0)||"file"==s.statementType()&&s.statementPath().length>0||"document"==s.statementType()&&s.associatedDocumentUuid()&&s.associatedDocumentUuid().length>0}),s.lastExecuted=i.a.observable(void 0!==a.lastExecuted&&null!=a.lastExecuted?a.lastExecuted:0),s.lastAceSelectionRowOffset=i.a.observable(a.lastAceSelectionRowOffset||0),s.executingBlockingOperation=null,s.showLongOperationWarning=i.a.observable(!1),s.showLongOperationWarning.subscribe(function(e){e&&hueAnalytics.convert("editor","showLongOperationWarning")});var R,H=-1;function L(){H=window.setTimeout(function(){s.showLongOperationWarning(!0)},2e3)}function U(){window.clearTimeout(H),s.showLongOperationWarning(!1)}s.lastExecutedStatements=void 0,s.lastExecutedSelectionRange=void 0,s.execute=function(a){if(!a&&s.ace()){var n=s.ace().getSelectionRange();!s.lastExecutedSelectionRange||n.start.row===n.end.row||n.start.column===n.end.column||n.start.row===s.lastExecutedSelectionRange.start.row&&n.start.column===s.lastExecutedSelectionRange.start.column&&n.end.row===s.lastExecutedSelectionRange.end.row&&n.end.column===s.lastExecutedSelectionRange.end.column||s.result.cancelBatchExecution(),s.lastExecutedSelectionRange=n}if(!s.isCanceling()){var i=(new Date).getTime();if(!(i-s.lastExecuted()<1e3)&&s.isReady()){if(a||("running"===s.status()||"loading"===s.status()?s.cancel():s.result.clear()),"impala"===s.type()&&(s.showExecutionAnalysis(!1),c.default.publish("editor.clear.execution.analysis")),s.status("running"),s.statusForButtons("executing"),s.isSqlDialect()&&c.default.publish("editor.refresh.statement.locations",s),s.lastExecutedStatements=s.statement(),s.ace()){c.default.publish("ace.set.autoexpand",{autoExpand:!1,snippet:s});var r=s.ace().getSelectionRange();s.lastAceSelectionRowOffset(Math.min(r.start.row,r.end.row))}s.previousChartOptions=e._getPreviousChartOptions(s),o()(document).trigger("executeStarted",{vm:e,snippet:s}),s.lastExecuted(i),o()(".jHueNotify").remove(),hueAnalytics.log("notebook","execute/"+s.type()),t.forceHistoryInitialHeight(!0),s.result.handle()&&s.close(),s.errors([]),c.default.publish("editor.clear.highlighted.errors",s.ace()),s.result.clear(),s.progress(0),s.jobs([]),s.result.logs(""),s.result.statement_range({start:{row:0,column:0},end:{row:0,column:0}}),t.historyCurrentPage(1),L(),s.currentQueryTab("queryHistory"),s.executingBlockingOperation=o.a.post("/notebook/api/execute/"+s.type(),{notebook:e.editorMode()?l.a.toJSON(t,h):l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext())},function(a){try{s.isSqlDialect()&&a&&a.handle?s.lastExecutedStatement(sqlStatementsParser.parse(a.handle.statement)[0]):s.lastExecutedStatement(null)}catch(e){s.lastExecutedStatement(null)}if(s.statusForButtons("executed"),c.default.publish("ace.set.autoexpand",{autoExpand:!0,snippet:s}),U(),e.editorMode()&&a.history_id){if(!e.isNotificationManager()){var n="/notebook/editor"+(e.isMobile()?"_m":"")+"?editor="+a.history_id;e.isHue4()&&(n=e.URLS.hue4+"?editor="+a.history_id),e.changeURL(n)}t.id(a.history_id),t.uuid(a.history_uuid),t.isHistory(!0),t.parentSavedQueryUuid(a.history_parent_uuid)}if(0===a.status?(s.result.handle(a.handle),s.result.hasResultset(a.handle.has_result_set),a.handle.sync?(s.loadData(a.result,100),s.status("available"),s.progress(100),s.result.endTime(new Date)):t.unloaded()||s.checkStatus(),e.isOptimizerEnabled()&&c.default.publish("editor.upload.query",a.history_id)):(s._ajaxError(a,s.execute),t.isExecutingAll(!1)),a.handle){if(e.editorMode())if(e.isNotificationManager()){var i=o.a.grep(t.history(),function(e){return e.uuid()==t.uuid()});1===i.length&&(i[0].status(s.status()),s.result.logs(a.message))}else t.history.unshift(t._makeHistoryRecord(url,a.handle.statement,s.lastExecuted(),s.status(),t.name(),t.uuid()));null!=a.handle.statements_count&&(s.result.statements_count(a.handle.statements_count),s.result.statement_id(a.handle.statement_id),s.result.previous_statement_hash(a.previous_statement_hash),a.handle.statements_count>1&&null!=a.handle.start&&null!=a.handle.end&&s.result.statement_range({start:a.handle.start,end:a.handle.end}))}}).fail(function(e,t,a){"canceled"!=s.statusForButtons()&&502!==e.status&&o()(document).trigger("error",e.responseText),s.status("failed"),s.statusForButtons("executed")}).always(function(){s.executingBlockingOperation=null})}}},s.reexecute=function(){s.result.cancelBatchExecution(),s.execute()},s.formatEnabled=i.a.pureComputed(function(){return s.statement_raw&&null!=s.statement_raw()&&s.statement_raw().length<4e5}),s.format=function(){s.isSqlDialect()&&u.default.formatSql({statements:""!=s.ace().getSelectedText()?s.ace().getSelectedText():s.statement_raw()}).done(function(e){0==e.status?""!=s.ace().getSelectedText()?s.ace().session.replace(s.ace().session.selection.getRange(),e.formatted_statements):(s.statement_raw(e.formatted_statements),s.ace().setValue(s.statement_raw(),1)):s._ajaxError(e)}),hueAnalytics.log("notebook","format")},s.clear=function(){hueAnalytics.log("notebook","clear"),s.ace().setValue("",1),s.result.clear(),s.status("ready")},s.explain=function(){hueAnalytics.log("notebook","explain"),""!=s.statement()&&"running"!=s.status()&&"loading"!==s.status()&&(s.result.explanation(""),s.errors([]),s.progress(0),s.status("ready"),o.a.post("/notebook/api/explain",{notebook:l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext())},function(e){0==e.status?(s.currentQueryTab("queryExplain"),s.result.fetchedOnce(!0),s.result.explanation(e.explanation)):s._ajaxError(e)}))},s.checkCompatibility=function(){s.hasSuggestion(null),s.compatibilitySourcePlatform(m[s.type()]),s.compatibilityTargetPlatform(b["hive"===s.type()?"impala":"hive"]),s.queryCompatibility()},s.queryCompatibility=function(e){u.default.cancelActiveRequest(R),hueAnalytics.log("notebook","compatibility"),s.compatibilityCheckRunning(e!=s.type()),s.hasSuggestion(null);var a=s.positionStatement();R=o.a.post("/notebook/api/optimizer/statement/compatibility",{notebook:l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext()),sourcePlatform:s.compatibilitySourcePlatform().value,targetPlatform:s.compatibilityTargetPlatform().value},function(e){if(0===e.status){if(s.aceErrorsHolder([]),s.aceWarningsHolder([]),s.suggestion(l.a.fromJS(e.query_compatibility)),s.suggestion().queryError&&s.suggestion().queryError.errorString()){var t=v.exec(s.suggestion().queryError.errorString()),n=null;t&&(n=a?a.location.first_line+parseInt(t[1])+1:parseInt(t[1])-1),s.aceWarningsHolder.push({message:s.suggestion().queryError.errorString(),line:n,col:null===t?null:void 0!==t[3]?parseInt(t[3]):null}),s.status("with-optimizer-report")}if(s.suggestion().parseError()){var i=v.exec(s.suggestion().parseError());s.aceErrorsHolder.push({message:s.suggestion().parseError(),line:null===i?null:parseInt(i[1])-1,col:null===i?null:void 0!==i[3]?parseInt(i[3]):null}),s.status("with-optimizer-report")}s.showOptimizer(!0),s.hasSuggestion(!0)}else o()(document).trigger("error",e.message)}).fail(function(e,t,a){502!==e.status&&o()(document).trigger("error",e.responseText)}).always(function(){s.compatibilityCheckRunning(!1)})},s.fetchResult=function(e,t){void 0===t&&(t=!0),s.fetchResultData(e,t)},s.isFetchingData=!1,s.fetchExecutionAnalysis=function(){"impala"===s.type()?c.default.publish("editor.update.execution.analysis",{analysisPossible:!0,compute:s.compute(),queryId:t.getContext().id(),name:s.jobs()[0]&&s.jobs()[0].name}):c.default.publish("editor.update.execution.analysis",{analysisPossible:!1})},s.fetchResultData=function(e,a){s.isFetchingData||("available"===s.status()?(L(),s.isFetchingData=!0,hueAnalytics.log("notebook","fetchResult/"+e+"/"+a),o.a.post("/notebook/api/fetch_result_data",{notebook:l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext()),rows:e,startOver:a},function(t){U(),0===(t=JSON.bigdataParse(t)).status?(s.showExecutionAnalysis(!0),s.loadData(t.result,e)):(s._ajaxError(t,function(){s.isFetchingData=!1,s.fetchResultData(e,a)}),o()(document).trigger("renderDataError",{snippet:s}))},"text").fail(function(e,t,a){502!==e.status&&o()(document).trigger("error",e.responseText)}).always(function(){s.isFetchingData=!1})):c.default.publish("editor.snippet.result.normal",s))},s.loadData=function(a,n){n-=a.data.length,a.data.length>0&&s.currentQueryTab("queryResults");var i=s.result.data().length,r=[];o.a.each(a.data,function(e,t){t.unshift(i+e+1),s.result.data.push(t),r.push(t)}),null!=s.result.rows()&&-1==(s.result.rows()+"").indexOf("+")||s.result.rows(s.result.data().length+(a.has_more?"+":"")),s.result.images(void 0!==a.images&&null!=a.images?a.images:[]),c.default.publish("editor.render.data",{data:r,snippet:s,initial:0==i}),s.result.fetchedOnce()||(a.meta.unshift({type:"INT_TYPE",name:"",comment:null}),s.result.meta(a.meta),s.result.type(a.type),s.result.fetchedOnce(!0)),s.result.meta().forEach(function(e){o.a.inArray(e.type,["TINYINT_TYPE","SMALLINT_TYPE","INT_TYPE","BIGINT_TYPE","FLOAT_TYPE","DOUBLE_TYPE","DECIMAL_TYPE"])>-1?e.cssClass="sort-numeric":o.a.inArray(e.type,["TIMESTAMP_TYPE","DATE_TYPE","DATETIME_TYPE"])>-1?e.cssClass="sort-date":e.cssClass="sort-string"}),s.result.hasMore(a.has_more),a.has_more&&n>0?setTimeout(function(){s.fetchResultData(n,!1)},500):e.editorMode()||t.isPresentationMode()||t.snippets()[t.snippets().length-1]!=s||t.newSnippet()},s.fetchResultMetadata=function(){o.a.post("/notebook/api/fetch_result_metadata",{notebook:l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext())},function(e){0==e.status?s.result.meta(e.result.meta):o()(document).trigger("error",e.message)}).fail(function(e,t,a){502!==e.status&&o()(document).trigger("error",e.responseText),s.status("failed")})},s.fetchResultSize=function(e,a){o.a.post("/notebook/api/fetch_result_size",{notebook:l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext())},function(o){a==t.id()&&(0==o.status?null!=o.result.rows?s.result.rows(o.result.rows):"impala"==s.type()&&e>0&&setTimeout(function(){s.fetchResultSize(e-1,a)},1e3):o.status)}).fail(function(e,t,a){})},s.checkStatus=function(){o.a.post("/notebook/api/check_status",{notebook:l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext())},function(a){if("canceling"==s.statusForButtons()||"canceled"==s.status());else{if(s.result.endTime(new Date),0===a.status)if(s.status(a.query_status.status),"running"==s.status()||"starting"==s.status()||"waiting"==s.status()){var o=s.result.executionTime()>45e3?5e3:1e3;t.unloaded()||(s.checkStatusTimeout=setTimeout(s.checkStatus,o))}else if("available"===s.status()){if(s.fetchResult(100),s.progress(100),s.isSqlDialect())if(s.result.handle().has_result_set){var n=t.id();setTimeout(function(){s.fetchResultSize(10,n)},2e3),s.checkDdlNotification()}else s.lastExecutedStatement()?s.checkDdlNotification():s.onDdlExecute();t.isExecutingAll()&&(t.executingAllIndex(t.executingAllIndex()+1),t.executingAllIndex()<t.snippets().length?t.snippets()[t.executingAllIndex()].execute():t.isExecutingAll(!1)),!s.result.handle().has_more_statements&&e.successUrl()&&(window.location.href=e.successUrl())}else"success"===s.status()&&s.progress(99);else-3===a.status?(s.status("expired"),t.isExecutingAll(!1)):(s._ajaxError(a),t.isExecutingAll(!1));s.getLogs()}}).fail(function(e,a,n){502!==e.status&&o()(document).trigger("error",e.responseText||a),s.status("failed"),t.isExecutingAll(!1)})},s.checkDdlNotification=function(){s.lastExecutedStatement()&&/ALTER|CREATE|DELETE|DROP|GRANT|INSERT|LOAD|SET|TRUNCATE|UPDATE|UPSERT|USE/i.test(s.lastExecutedStatement().firstToken)?s.onDdlExecute():window.clearTimeout(s.executeNextTimeout)},s.isCanceling=i.a.observable(!1),s.cancel=function(){window.clearTimeout(s.executeNextTimeout),s.isCanceling(!0),null!=s.checkStatusTimeout&&(clearTimeout(s.checkStatusTimeout),s.checkStatusTimeout=null),hueAnalytics.log("notebook","cancel"),null!=s.executingBlockingOperation&&(s.executingBlockingOperation.abort(),s.executingBlockingOperation=null),o.a.isEmptyObject(s.result.handle())?(s.statusForButtons("canceled"),s.status("failed"),s.isCanceling(!1),t.isExecutingAll(!1)):(s.statusForButtons("canceling"),o.a.post("/notebook/api/cancel_statement",{notebook:l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext())},function(e){s.statusForButtons("canceled"),0==e.status?(s.status("canceled"),t.isExecutingAll(!1)):s._ajaxError(e)}).fail(function(e,a,n){502!==e.status&&o()(document).trigger("error",e.responseText),s.statusForButtons("canceled"),s.status("failed"),t.isExecutingAll(!1)}).always(function(){s.isCanceling(!1)}))},s.close=function(){null!=s.checkStatusTimeout&&(clearTimeout(s.checkStatusTimeout),s.checkStatusTimeout=null),o.a.post("/notebook/api/close_statement",{notebook:l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext())},function(e){e.status}).fail(function(e,t,a){e.status})},s.getLogs=function(){o.a.post("/notebook/api/get_logs",{notebook:l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext()),from:s.result.logLines,jobs:l.a.toJSON(s.jobs,{ignore:["percentJob"]}),full_log:s.result.logs},function(e){if(1==e.status&&(e.status=0,e.logs=e.message),0==e.status){if(e.logs.length>0){var t=e.logs.split("\n");s.result.logLines+=t.length;var a=s.result.logs();e.logs&&(""===a||s.wasBatchExecuted()&&-1==e.logs.indexOf("Unable to locate")||e.isFullLogs)?s.result.logs(e.logs):s.result.logs(a+"\n"+e.logs)}s.jobs().forEach(function(e){void 0===e.percentJob&&(e.percentJob=i.a.observable(-1))}),e.jobs&&e.jobs.length>0&&(e.jobs.forEach(function(e){var t=i.a.utils.arrayFilter(s.jobs(),function(t){return t.name===e.name});if(0===t.length)void 0===e.percentJob?e.percentJob=i.a.observable(-1):e.percentJob=i.a.observable(e.percentJob),s.jobs.push(e);else if(void 0!==e.percentJob)for(var a=0;a<t.length;a++)t[a].percentJob(e.percentJob)}),s.jobs().forEach(function(e){0===i.a.utils.arrayFilter(s.jobs(),function(t){return t.name===e.name}).length&&s.jobs.remove(e)})),"running"==s.status()&&s.progress(e.progress)}else s._ajaxError(e)}).fail(function(e,t,a){502!==e.status&&o()(document).trigger("error",e.responseText||t),s.status("failed")})},s.uploadQueryHistory=function(e){hueAnalytics.log("notebook","upload_query_history"),o.a.post("/metadata/api/optimizer/upload/history",{n:void 0!==e?e:null,sourcePlatform:s.type()},function(e){0==e.status?(o()(document).trigger("info",e.upload_history[s.type()].count+" queries uploaded successfully. Processing them..."),s.watchUploadStatus(e.upload_history[s.type()].status.workloadId)):o()(document).trigger("error",e.message)})},s.uploadQuery=function(e){o.a.post("/metadata/api/optimizer/upload/query",{query_id:e,sourcePlatform:s.type()})},s.uploadTableStats=function(e){hueAnalytics.log("notebook","load_table_stats"),e.showProgress&&o()(document).trigger("info","Preparing table data..."),o.a.post("/metadata/api/optimizer/upload/table_stats",{db_tables:l.a.toJSON(o.a.map(e.activeTables,function(e){return e.databaseName+"."+e.tableName})),sourcePlatform:l.a.toJSON(s.type()),with_ddl:l.a.toJSON(!0),with_table_stats:l.a.toJSON(!0),with_columns_stats:l.a.toJSON(!0)},function(t){0==t.status?(e.showProgress&&o()(document).trigger("info",o.a.map(e.activeTables,function(e){return e.tableName})+" stats sent to analyse"),t.upload_table_ddl&&e.showProgress&&s.watchUploadStatus(t.upload_table_ddl.status.workloadId,e.showProgress)):e.showProgress&&o()(document).trigger("error",t.message)}).always(function(){e.callback&&e.callback()})},s.watchUploadStatus=function(e,t){o.a.post("/metadata/api/optimizer/upload/status",{workloadId:e},function(a){0==a.status?(t&&o()(document).trigger("info","Query processing: "+a.upload_status.status.state),-1!=["WAITING","IN_PROGRESS"].indexOf(a.upload_status.status.state)?window.setTimeout(function(){s.watchUploadStatus(e)},2e3):t&&o()(document).trigger("warn",a.upload_status.status.statusMsg+(a.upload_status.status.failedQueries>0?". "+a.upload_status.status.failQueryDetails.map(function(e){return e.error}):""))):t&&o()(document).trigger("error",a.message)})},s.getSimilarQueries=function(){hueAnalytics.log("notebook","get_query_similarity"),o.a.post("/notebook/api/optimizer/statement/similarity",{notebook:l.a.toJSON(t.getContext()),snippet:l.a.toJSON(s.getContext()),sourcePlatform:s.type()},function(e){0==e.status?console.log(e.statement_similarity):o()(document).trigger("error",e.message)})},s.autocompleter=new Autocompleter({snippet:s,user:e.user,optEnabled:!1,timeout:e.autocompleteTimeout,useNewAutocompleter:e.useNewAutocompleter}),s.init=function(){"running"!=s.status()&&"available"!=s.status()||!t.isHistory()?"loading"==s.status()?(s.status("failed"),s.progress(0),s.jobs([])):"ready-execute"==s.status()&&s.execute():s.checkStatus()},s.onKeydownInVariable=function(e,t){return(t.ctrlKey||t.metaKey)&&13===t.which?s.ace().commands.commands.execute.exec():(t.ctrlKey||t.metaKey)&&83===t.which&&(s.ace().commands.commands.save.exec(),t.preventDefault()),!0}},S=function(e,t){var a=this;l.a.fromJS(t,{},a),a.selectedSessionProperty=i.a.observable(""),a.restarting=i.a.observable(!1),i.a.isObservable(a.properties)||(a.properties=i.a.observableArray()),a.availableNewProperties=i.a.computed(function(){var t={};return o.a.each(a.properties(),function(e,a){t[a.key]=!0}),o.a.grep(e.availableSessionProperties(),function(e){return!t[e.name]})})},w=function(e,t){var a=this;a.id=i.a.observable(void 0!==t.id&&null!=t.id?t.id:null),a.uuid=i.a.observable(void 0!==t.uuid&&null!=t.uuid?t.uuid:d.default.UUID()),a.name=i.a.observable(void 0!==t.name&&null!=t.name?t.name:"My Notebook"),a.description=i.a.observable(void 0!==t.description&&null!=t.description?t.description:""),a.type=i.a.observable(void 0!==t.type&&null!=t.type?t.type:"notebook"),a.initialType=a.type().replace("query-",""),a.coordinatorUuid=i.a.observable(void 0!==t.coordinatorUuid&&null!=t.coordinatorUuid?t.coordinatorUuid:null),a.isHistory=i.a.observable(void 0!==t.is_history&&null!=t.is_history&&t.is_history),a.isManaged=i.a.observable(void 0!==t.isManaged&&null!=t.isManaged&&t.isManaged),a.parentSavedQueryUuid=i.a.observable(void 0!==t.parentSavedQueryUuid&&null!=t.parentSavedQueryUuid?t.parentSavedQueryUuid:null),a.isSaved=i.a.observable(void 0!==t.isSaved&&null!=t.isSaved&&t.isSaved),a.canWrite=i.a.observable(void 0===t.can_write||null==t.can_write||t.can_write),a.onSuccessUrl=i.a.observable(void 0!==t.onSuccessUrl&&null!=t.onSuccessUrl?t.onSuccessUrl:null),a.pubSubUrl=i.a.observable(void 0!==t.pubSubUrl&&null!=t.pubSubUrl?t.pubSubUrl:null),a.isPresentationModeDefault=i.a.observable(void 0!==t.isPresentationModeDefault&&null!=t.isPresentationModeDefault&&t.isPresentationModeDefault),a.isPresentationMode=i.a.observable(!1),a.isPresentationModeInitialized=i.a.observable(!1),a.isPresentationMode.subscribe(function(t){t||a.cancelExecutingAll(),c.default.publish("editor.presentation.operate.toggle",t),e.togglePresentationMode(),t&&hueAnalytics.convert("editor","presentation")}),a.presentationSnippets=i.a.observable({}),a.isHidingCode=i.a.observable(void 0!==t.isHidingCode&&null!=t.isHidingCode&&t.isHidingCode),a.snippets=i.a.observableArray(),a.selectedSnippet=i.a.observable(e.editorType()),a.creatingSessionLocks=i.a.observableArray(),a.sessions=l.a.fromJS(void 0!==t.sessions&&null!=t.sessions?t.sessions:[],{create:function(t){return new S(e,t.data)}}),a.directoryUuid=i.a.observable(void 0!==t.directoryUuid&&null!=t.directoryUuid?t.directoryUuid:null),a.dependents=l.a.fromJS(void 0!==t.dependents&&null!=t.dependents?t.dependents:[]),a.dependentsCoordinator=i.a.computed(function(){return o.a.grep(a.dependents(),function(e){return"oozie-coordinator2"==e.type()&&1==e.is_managed()})}),a.dependentsCoordinator().length>0&&!a.coordinatorUuid()&&a.coordinatorUuid(a.dependentsCoordinator()[0].uuid()),a.history=i.a.observableArray(e.selectedNotebook()&&e.selectedNotebook().history().length>0&&e.selectedNotebook().history()[0].type==a.type()?e.selectedNotebook().history():[]),a.history.subscribe(function(t){null!=a.id()||0!=t.length||""!==a.historyFilter()||e.isNotificationManager()||a.snippets()[0].currentQueryTab("undefined"!=typeof IS_EMBEDDED&&IS_EMBEDDED?"queryHistory":"savedQueries")}),a.historyFilter=i.a.observable(""),a.historyFilterVisible=i.a.observable(!1),a.historyFilter.extend({rateLimit:{method:"notifyWhenChangesStop",timeout:900}}),a.historyFilter.subscribe(function(e){1!=a.historyCurrentPage()?a.historyCurrentPage(1):a.fetchHistory()}),a.loadingHistory=i.a.observable(0==a.history().length),a.historyInitialHeight=i.a.observable(0).extend({throttle:1e3}),a.forceHistoryInitialHeight=i.a.observable(!1),a.historyCurrentPage=i.a.observable(e.selectedNotebook()?e.selectedNotebook().historyCurrentPage():1),a.historyCurrentPage.subscribe(function(e){a.fetchHistory()}),a.historyTotalPages=i.a.observable(e.selectedNotebook()?e.selectedNotebook().historyTotalPages():1),a.schedulerViewModel=null,a.schedulerViewModelIsLoaded=i.a.observable(!1),a.schedulerViewerViewModel=i.a.observable(),a.isBatchable=i.a.computed(function(){return a.snippets().length>0&&o.a.grep(a.snippets(),function(e){return e.isBatchable()}).length==a.snippets().length}),a.isExecutingAll=i.a.observable(!!t.isExecutingAll),a.cancelExecutingAll=function(){var e=a.executingAllIndex();a.isExecutingAll()&&a.snippets()[e]&&a.snippets()[e].cancel()},a.executingAllIndex=i.a.observable(t.executingAllIndex||0),a.retryModalConfirm=null,a.retryModalCancel=null,a.avoidClosing=!1,a.canSave=e.canSave,a.getSession=function(e){var t=null;return o.a.each(a.sessions(),function(a,s){if(s.type()==e)return t=s,!1}),t},a.getSnippets=function(e){return o.a.grep(a.snippets(),function(t){return t.type()==e})},a.unloaded=i.a.observable(!1),a.unload=function(){a.unloaded(!0);var e=null;return a.snippets().forEach(function(t){null!=t.checkStatusTimeout&&(clearTimeout(t.checkStatusTimeout),t.checkStatusTimeout=null),null==e&&(e=t.queries())}),e},a.restartSession=function(e,t){if(!e.restarting()){e.restarting(!0);var s=a.getSnippets(e.type());o.a.each(s,function(e,t){t.status("loading")});l.a.toJSON(e);a.closeSession(e,!0,function(){a.createSession(e,function(){o.a.each(s,function(e,t){t.status("ready")}),e.restarting(!1),t&&t()},function(){e.restarting(!1)})})}},a.addSession=function(e){var t=[];o.a.each(a.sessions(),function(a,s){s.type()==e.type()&&t.push(s)}),o.a.each(t,function(e,t){a.sessions.remove(t)}),a.sessions.push(e)},a.addSnippet=function(t,s){var o=new y(e,a,t);return a.snippets.push(o),null==a.getSession(o.type())&&void 0===s&&window.setTimeout(function(){o.status("loading"),a.createSession(new S(e,{type:o.type()}))},200),o.init(),o},a.createSession=function(e,t,s){if(-1==a.creatingSessionLocks().indexOf(e.type())){a.creatingSessionLocks.push(e.type());var n=null;o.a.each(a.getSnippets(e.type()),function(e,t){t.status("loading"),0==e&&(n=t.compute())});var i=function(t){o.a.each(a.getSnippets(e.type()),function(e,t){t.status("failed")}),o()(document).trigger("error",t),s&&s()};o.a.post("/notebook/api/create_session",{notebook:l.a.toJSON(a.getContext()),session:l.a.toJSON(e),cluster:l.a.toJSON(n||"")},function(s){0==s.status?(l.a.fromJS(s.session,{},e),null==a.getSession(e.type())&&a.addSession(e),o.a.each(a.getSnippets(e.type()),function(e,t){t.status("ready")}),t&&setTimeout(t,500)):401==s.status?o()(document).trigger("showAuthModal",{type:e.type()}):i(s.message)}).fail(function(e){502!==e.status&&i(e.responseText)}).always(function(){a.creatingSessionLocks.remove(e.type())})}},a.authSession=function(){a.createSession(new S(e,{type:e.authSessionType(),properties:[{name:"user",value:e.authSessionUsername()},{name:"password",value:e.authSessionPassword()}]}),e.authSessionCallback())},a.newSnippet=function(e){e&&a.selectedSnippet(e);var t=a.addSnippet({type:a.selectedSnippet(),result:{}});return window.setTimeout(function(){var e=t;null!=e.ace()&&e.ace().focus()},100),hueAnalytics.log("notebook","add_snippet/"+(e||a.selectedSnippet())),t},a.newSnippetAbove=function(e){a.newSnippet();var t=0;a.snippets().forEach(function(a,s){a.id()==e&&(t=s)}),a.snippets(a.snippets().move(a.snippets().length-1,t))},a.getContext=function(){return{id:a.id,uuid:a.uuid,parentSavedQueryUuid:a.parentSavedQueryUuid,isSaved:a.isSaved,sessions:a.sessions,type:a.type,name:a.name}},a.save=function(t){hueAnalytics.log("notebook","save");var s=l.a.toJS(a,h);o.a.each(s.snippets.concat(Object.keys(s.presentationSnippets).map(function(e){return s.presentationSnippets[e]})),function(e,t){t.result.data.length=0,t.result.meta.length=0,t.result.logs="",t.result.fetchedOnce=!1,t.progress=0,t.jobs.length=0}),s.schedulerViewModel&&(s.schedulerViewModel.availableTimezones=[]);var n=e.editorMode()||a.isPresentationMode()&&"notebook"!=e.editorType();o.a.post("/notebook/api/notebook/save",{notebook:l.a.toJSON(s,h),editorMode:n},function(s){if(0==s.status){a.id(s.id),a.isSaved(!0);var i=a.isHistory();if(a.isHistory(!1),o()(document).trigger("info",s.message),n){if(s.save_as)a.snippets()[0].queries().length>0&&a.snippets()[0].queries.unshift(l.a.fromJS(s));else{var r=a.snippets()[0].queries().filter(function(e){return e.uuid()===s.uuid});r.length>0&&(r[0].name(s.name),r[0].description(s.description),r[0].last_modified(s.last_modified))}a.coordinatorUuid()&&a.schedulerViewModel&&(a.saveScheduler(),a.schedulerViewModel.coordinator.refreshParameters()),(i||s.save_as)&&a.loadScheduler(),a.snippets()[0].downloadResultViewModel&&"dashboard"===a.snippets()[0].downloadResultViewModel().saveTarget()?c.default.publish("open.link",e.URLS.report+"&uuid="+s.uuid+"&statement="+a.snippets()[0].result.handle().statement_id):e.isHue4()?e.changeURL(e.URLS.hue4+"?editor="+s.id):e.changeURL("/notebook/editor"+(e.isMobile()?"_m":"")+"?editor="+s.id)}else e.isHue4()?e.changeURL(e.URLS.hue4_notebook+"?notebook="+s.id):e.changeURL("/notebook/notebook?notebook="+s.id);"function"==typeof t&&t()}else o()(document).trigger("error",s.message)}).fail(function(e,t,a){502!==e.status&&o()(document).trigger("error",e.responseText)})},a.close=function(){hueAnalytics.log("notebook","close"),o.a.post("/notebook/api/notebook/close",{notebook:l.a.toJSON(a,h),editorMode:e.editorMode()})},a.clearResults=function(){o.a.each(a.snippets(),function(e,t){t.result.clear(),t.status("ready")})},a.executeAll=function(){a.isExecutingAll()||0===a.snippets().length||(a.isExecutingAll(!0),a.executingAllIndex(0),a.snippets()[a.executingAllIndex()].execute())},a.saveDefaultUserProperties=function(t){u.default.saveConfiguration({app:t.type(),properties:t.properties,userId:e.userId})},a.closeAndRemoveSession=function(e){a.closeSession(e,!1,function(){a.sessions.remove(e)})},a.closeSession=function(e,t,a){o.a.post("/notebook/api/close_session",{session:l.a.toJSON(e)},function(e){!t&&e&&0!=e.status&&-2!=e.status&&e.message&&o()(document).trigger("error",e.message),a&&a()}).fail(function(e){t||502===e.status||o()(document).trigger("error",e.responseText)})},a.fetchHistory=function(t){a.loadingHistory(!0),o.a.get("/notebook/api/get_history",{doc_type:a.selectedSnippet(),limit:50,page:a.historyCurrentPage(),doc_text:a.historyFilter(),is_notification_manager:e.isNotificationManager()},function(e){var t=[];e&&e.history&&e.history.forEach(function(e){t.push(a._makeHistoryRecord(e.absoluteUrl,e.data.statement,e.data.lastExecuted,e.data.status,e.name,e.uuid))}),a.history(t),a.historyTotalPages(Math.ceil(e.count/50))}).always(function(){a.loadingHistory(!1),t&&t()})},a.prevHistoryPage=function(){1!==a.historyCurrentPage()&&a.historyCurrentPage(a.historyCurrentPage()-1)},a.nextHistoryPage=function(){a.historyCurrentPage()<a.historyTotalPages()&&a.historyCurrentPage(a.historyCurrentPage()+1)},a.updateHistoryFailed=!1,a.updateHistory=function(e,t){var s=o.a.grep(a.history(),function(t){return-1!=e.indexOf(t.status())}).slice(0,25);s.length>0?function n(i){o.a.post("/notebook/api/check_status",{notebook:l.a.toJSON({id:i.uuid()})}).done(function(e){var t=-3==e.status?"expired":0==e.status?e.query_status.status:"failed";t&&i.status()!=t&&i.status(t)}).fail(function(e){s=[],a.updateHistoryFailed=!0,console.warn("Lost connectivity to the Hue history refresh backend.")}).always(function(){s.length>0?window.setTimeout(function(){n(s.pop())},1e3):a.updateHistoryFailed||window.setTimeout(function(){a.updateHistory(e,t)},t)})}(s.pop()):a.updateHistoryFailed||window.setTimeout(function(){a.updateHistory(e,t)},t)},a._makeHistoryRecord=function(e,t,a,s,o,n){return l.a.fromJS({url:e,query:t.substring(0,1e3)+(t.length>1e3?"...":""),lastExecuted:a,status:s,name:o,uuid:n})},a.clearHistory=function(t){hueAnalytics.log("notebook","clearHistory"),o.a.post("/notebook/api/clear_history",{notebook:l.a.toJSON(a.getContext()),doc_type:a.selectedSnippet(),is_notification_manager:e.isNotificationManager()},function(t){a.history.removeAll(),a.isHistory()&&(a.id(null),a.uuid(d.default.UUID()),e.isHue4()?e.changeURL(e.URLS.hue4+"?type="+e.editorType()):e.changeURL("/notebook/editor"+(e.isMobile()?"_m":"")+"?type="+e.editorType()))}).fail(function(e){502!==e.status&&o()(document).trigger("error",e.responseText)}),o()(document).trigger("hideHistoryModal")},a.loadScheduler=function(){if(void 0!==e.CoordinatorEditorViewModel&&a.isBatchable()){var t;t=a.coordinatorUuid()?"edit":"new",hueAnalytics.log("notebook","schedule/"+t);IS_HUE_4||c.default.subscribe("hue4.process.headers",function(e){e.callback(e.response)},e.huePubSubId),o.a.get("/oozie/editor/coordinator/"+t+"/",{format:"json",document:a.uuid(),coordinator:a.coordinatorUuid()},function(s){o()("#schedulerEditor").length>0&&c.default.publish("hue4.process.headers",{response:s.layout,callback:function(n){o()("#schedulerEditor").html(n),a.schedulerViewModel=new e.CoordinatorEditorViewModel(s.coordinator,s.credentials,s.workflows,s.can_edit),i.a.cleanNode(o()("#schedulerEditor")[0]),i.a.applyBindings(a.schedulerViewModel,o()("#schedulerEditor")[0]),o()(document).off("showSubmitPopup"),o()(document).on("showSubmitPopup",function(e,t){o()(".submit-modal-editor").html(t),o()(".submit-modal-editor").modal("show"),o()(".submit-modal-editor").on("hidden",function(){c.default.publish("hide.datepicker")}),o()('.submit-form .control-group[rel!="popover"]:visible').length>0&&o()(".submit-modal-editor .modal-body").height(o()(".submit-modal-editor .modal-body").height()+60)}),c.default.publish("render.jqcron"),a.schedulerViewModel.coordinator.properties.cron_advanced.valueHasMutated(),a.schedulerViewModel.coordinator.tracker().markCurrentStateAsClean(),a.schedulerViewModel.isEditing(!0),a.schedulerViewModelIsLoaded(!0),"new"==t&&a.schedulerViewModel.coordinator.properties.document(a.uuid())}})}).fail(function(e){502!==e.status&&o()(document).trigger("error",e.responseText)})}},a.saveScheduler=function(){!a.isBatchable()||a.coordinatorUuid()&&!a.schedulerViewModel.coordinator.isDirty()||(a.schedulerViewModel.coordinator.isManaged(!0),a.schedulerViewModel.coordinator.properties.document(a.uuid()),a.schedulerViewModel.save(function(e){a.coordinatorUuid()||(a.coordinatorUuid(e.uuid),a.save())}))},a.showSubmitPopup=function(){o.a.get("/oozie/editor/coordinator/submit/"+a.coordinatorUuid(),{format:"json"},function(e){o()(document).trigger("showSubmitPopup",e)}).fail(function(e,t,a){502!==e.status&&o()(document).trigger("error",e.responseText)})},a.viewSchedulerId=i.a.observable(void 0!==t.viewSchedulerId&&null!=t.viewSchedulerId?t.viewSchedulerId:""),a.viewSchedulerId.subscribe(function(e){a.save()}),a.isSchedulerJobRunning=i.a.observable(),a.loadingScheduler=i.a.observable(!1),t.snippets&&(o.a.each(t.snippets,function(e,t){a.addSnippet(t)}),void 0!==t.presentationSnippets&&null!=t.presentationSnippets&&o.a.each(t.presentationSnippets,function(t,s){s.status="ready";var o=new y(e,a,s);o.init(),o.previousChartOptions=e._getPreviousChartOptions(o),a.presentationSnippets()[t]=o}),e.editorMode()&&0==a.history().length&&a.fetchHistory(function(){a.updateHistory(["starting","running"],3e4),a.updateHistory(["available"],3e5)})),c.default.subscribeOnce("assist.db.panel.ready",function(){if(0===a.type().indexOf("query")){var e=function(e){c.default.publish("assist.set.database",{source:e.type(),namespace:e.namespace(),name:e.database()})},t=function(t){if(t.database())e(t);else var a=t.database.subscribe(function(){a.dispose(),e(t)})},s=function(e){if(e.namespace())t(e);else var a=e.namespace.subscribe(function(){a.dispose(),t(e)})};if(1===a.snippets().length)s(a.snippets()[0]);else var o=a.snippets.subscribe(function(e){1===e.length&&s(e[0]),o.dispose()})}},e.huePubSubId),c.default.publish("assist.is.db.panel.ready")};t.default=function(e,t,a,s,n){var r=this;r.URLS={editor:"/notebook/editor",editorMobile:"/notebook/editor_m",notebook:"/notebook/notebook",hue4:"/hue/editor",hue4_notebook:"/hue/notebook",report:"/hue/dashboard/new_search?engine=report"},r.huePubSubId=a.huePubSubId||"editor",r.user=a.user,r.userId=a.userId,r.suffix=a.suffix,r.isMobile=i.a.observable(a.mobile),r.isHue4=i.a.observable(a.hue4),r.isNotificationManager=i.a.observable(a.is_notification_manager||!1),r.editorType=i.a.observable(a.editor_type),r.editorType.subscribe(function(e){r.editorMode("notebook"!=e),d.default.changeURLParameter("type",e),r.editorMode()&&r.selectedNotebook().fetchHistory()}),r.preEditorTogglingSnippet=i.a.observable(),r.toggleEditorMode=function(){var e=r.selectedNotebook(),t=[];if("notebook"!=r.editorType()){r.editorType("notebook"),r.preEditorTogglingSnippet(e.snippets()[0]);var a=e.snippets()[0].variables(),s=[];e.type("notebook"),e.snippets()[0].statementsList().forEach(function(o){var n;if(o.hashCode()in e.presentationSnippets())(n=e.presentationSnippets()[o.hashCode()]).variables(a);else{var i=[],u=[];o.trim().split("\n").forEach(function(e){e.trim().startsWith("--")&&0===u.length?i.push(e.substr(2)):u.push(e)}),(n=new y(r,e,{type:e.initialType,statement_raw:u.join("\n"),result:{},name:i.join("\n"),variables:l.a.toJS(a)})).variables=e.snippets()[0].variables,n.init(),e.presentationSnippets()[o.hashCode()]=n}s.push(o.hashCode()),t.push(n)}),o.a.each(e.presentationSnippets(),function(t){!t in s&&delete e.presentationSnippets()[t]})}else r.editorType(e.initialType),t.push(r.preEditorTogglingSnippet()),e.type("query-"+e.initialType);e.snippets(t),t.forEach(function(e){c.default.publish("editor.redraw.data",{snippet:e})})},r.togglePresentationMode=function(){"notebook"!==r.selectedNotebook().initialType&&r.toggleEditorMode()},r.editorTypeTitle=i.a.pureComputed(function(){var e=o.a.grep(a.languages,function(e){return e.type===r.editorType()});return e.length>0?e[0].name:r.editorType()}),r.useNewAutocompleter=a.useNewAutocompleter||!1,r.autocompleteTimeout=a.autocompleteTimeout,r.selectedNotebook=i.a.observable(),r.combinedContent=i.a.observable(),r.isPresentationModeEnabled=i.a.pureComputed(function(){return r.selectedNotebook()&&1===r.selectedNotebook().snippets().length&&r.selectedNotebook().snippets()[0].isSqlDialect()}),r.isResultFullScreenMode=i.a.observable(!1),r.isPresentationMode=i.a.computed(function(){return r.selectedNotebook()&&r.selectedNotebook().isPresentationMode()}),r.isHidingCode=i.a.computed(function(){return r.selectedNotebook()&&r.selectedNotebook().isHidingCode()}),r.successUrl=i.a.observable(a.success_url),r.isOptimizerEnabled=i.a.observable(a.is_optimizer_enabled),r.isNavigatorEnabled=i.a.observable(a.is_navigator_enabled),r.CoordinatorEditorViewModel=s,r.RunningCoordinatorModel=n,r.canSave=i.a.computed(function(){return r.selectedNotebook()&&r.selectedNotebook().canWrite()&&(r.selectedNotebook().isSaved()||r.selectedNotebook().isHistory()&&r.selectedNotebook().parentSavedQueryUuid())}),r.sqlSourceTypes=[],r.availableLanguages=[],a.languages&&a.snippetViewSettings&&o.a.each(a.languages,function(e,t){r.availableLanguages.push({type:t.type,name:t.name,interface:t.interface});var s=a.snippetViewSettings[t.type];s&&s.sqlDialect&&r.sqlSourceTypes.push({type:t.type,name:t.name})});var p=o.a.grep(r.sqlSourceTypes,function(e){return e.type==r.editorType()});p.length>0?r.activeSqlSourceType=p[0].type:r.activeSqlSourceType=null,r.displayCombinedContent=function(){if(r.selectedNotebook()){var e="";o.a.each(r.selectedNotebook().snippets(),function(t,a){a.statement()&&(e&&(e+="\n\n"),e+=a.statement())}),r.combinedContent(e)}else r.combinedContent("");o()("#combinedContentModal"+r.suffix).modal("show")},r.isEditing=i.a.observable(!1),r.isEditing.subscribe(function(){o()(document).trigger("editingToggled")}),r.toggleEditing=function(){r.isEditing(!r.isEditing())},r.authSessionUsername=i.a.observable(),r.authSessionPassword=i.a.observable(),r.authSessionType=i.a.observable(),r.authSessionCallback=i.a.observable(),r.removeSnippetConfirmation=i.a.observable(),r.removeSnippet=function(e,t){var a=t.statement_raw().length>0;a||o.a.each(t.properties(),function(e,t){a=a||i.a.isObservable(t)&&t().length>0}),a?(r.removeSnippetConfirmation({notebook:e,snippet:t}),o()("#removeSnippetModal"+r.suffix).modal("show")):(e.snippets.remove(t),window.setTimeout(function(){o()(document).trigger("editorSizeChanged")},100))},r.assistAvailable=i.a.observable(a.assistAvailable),r.assistWithoutStorage=i.a.observable(!1),r.isLeftPanelVisible=i.a.observable(u.default.getFromTotalStorage("assist","assist_panel_visible",!0)),r.isLeftPanelVisible.subscribe(function(e){r.assistWithoutStorage()||u.default.setInTotalStorage("assist","assist_panel_visible",e)}),r.isRightPanelAvailable=i.a.observable(a.assistAvailable&&HAS_OPTIMIZER),r.isRightPanelVisible=i.a.observable(u.default.getFromTotalStorage("assist","right_assist_panel_visible",!0)),r.isRightPanelVisible.subscribe(function(e){r.assistWithoutStorage()||u.default.setInTotalStorage("assist","right_assist_panel_visible",e)});var h=function(e){var t,a=r.selectedNotebook();a&&(1===a.snippets().length?t=a.snippets()[0]:a.snippets().every(function(e){return!e.inFocus()||(t=e,!1)})),t&&e(t)};c.default.subscribe("assist.highlight.risk.suggestions",function(){r.isRightPanelAvailable()&&!r.isRightPanelVisible()&&r.isRightPanelVisible(!0)}),r.isContextPanelVisible=i.a.observable(!1),r.isContextPanelVisible.subscribe(function(e){c.default.publish("context.panel.visible",e)}),c.default.subscribe("context.panel.visible.editor",r.isContextPanelVisible),c.default.subscribe("get.active.snippet.type",function(){h(function(e){c.default.publish("set.active.snippet.type",e.type())})},r.huePubSubId),c.default.subscribe("save.snippet.to.file",function(){h(function(e){var t={path:e.statementPath(),contents:e.statement()},a={successCallback:function(e){e&&e.exists?o()(document).trigger("info",e.path+" saved successfully."):r._ajaxError(e)}};u.default.saveSnippetToFile(t,a)})},r.huePubSubId),c.default.subscribe("sql.context.pin",function(e){h(function(t){e.tabId="context"+t.pinnedContextTabs().length,t.pinnedContextTabs.push(e),t.currentQueryTab(e.tabId)})},r.huePubSubId),c.default.subscribe("assist.database.set",function(e){h(function(t){t.handleAssistSelection(e)})},r.huePubSubId),c.default.subscribe("assist.database.selected",function(e){h(function(t){t.handleAssistSelection(e)})},r.huePubSubId),r.availableSnippets=l.a.fromJS(a.languages),r.editorMode=i.a.observable("editor"==a.mode),r.getSnippetViewSettings=function(e){return a.snippetViewSettings[e]?a.snippetViewSettings[e]:a.snippetViewSettings.default},r.availableSessionProperties=i.a.computed(function(){return i.a.utils.arrayFilter(a.session_properties,function(e){return""!=e.name})}),r.getSessionProperties=function(e){var t=null;return o.a.each(a.session_properties,function(a,s){s.name!=e||(t=s)}),t},r.getSnippetName=function(e){for(var t=r.availableSnippets(),a=0;a<t.length;a++)if(t[a].type()===e)return t[a].name();return""},r.changeURL=function(e){r.isNotificationManager()||d.default.changeURL(e)},r.init=function(){e?r.openNotebook(e):""!==window.location.getParameter("editor")?r.openNotebook(window.location.getParameter("editor")):t.length>0?r.loadNotebook(t[0]):""!==window.location.getParameter("type")?r.newNotebook(window.location.getParameter("type")):r.newNotebook()},r.loadNotebook=function(e,t){var a;null!=r.selectedNotebook()&&(a=r.selectedNotebook().unload());var s=new w(r,e);s.snippets().length>0&&(c.default.publish("detach.scrolls",s.snippets()[0]),s.selectedSnippet(s.snippets()[s.snippets().length-1].type()),null!=a&&s.snippets()[0].queries(a),s.snippets().forEach(function(e){if(e.aceAutoExpand=!1,e.statement_raw.valueHasMutated(),e.result.handle().statements_count>1&&null!=e.result.handle().start&&null!=e.result.handle().end){var t=e.result.handle().aceLineOffset||0;e.result.statement_range({start:{row:e.result.handle().start.row+t,column:e.result.handle().start.column},end:{row:e.result.handle().end.row+t,column:e.result.handle().end.column}}),e.result.statement_range.valueHasMutated()}e.previousChartOptions=r._getPreviousChartOptions(e)}),s.snippets()[0].result.data().length>0?o()(document).trigger("redrawResults"):t&&s.snippets()[0].currentQueryTab(t),s.isSaved()&&(s.snippets()[0].currentQueryTab("savedQueries"),0===s.snippets()[0].queries().length&&s.snippets()[0].fetchQueries())),r.selectedNotebook(s),c.default.publish("check.job.browser"),c.default.publish("recalculate.name.description.width")},r._getPreviousChartOptions=function(e){return{chartLimit:void 0!==e.chartLimit()?e.chartLimit():e.previousChartOptions.chartLimit,chartX:void 0!==e.chartX()?e.chartX():e.previousChartOptions.chartX,chartXPivot:void 0!==e.chartXPivot()?e.chartXPivot():e.previousChartOptions.chartXPivot,chartYSingle:void 0!==e.chartYSingle()?e.chartYSingle():e.previousChartOptions.chartYSingle,chartMapType:void 0!==e.chartMapType()?e.chartMapType():e.previousChartOptions.chartMapType,chartMapLabel:void 0!==e.chartMapLabel()?e.chartMapLabel():e.previousChartOptions.chartMapLabel,chartMapHeat:void 0!==e.chartMapHeat()?e.chartMapHeat():e.previousChartOptions.chartMapHeat,chartYMulti:void 0!==e.chartYMulti()?e.chartYMulti():e.previousChartOptions.chartYMulti,chartScope:void 0!==e.chartScope()?e.chartScope():e.previousChartOptions.chartScope,chartTimelineType:void 0!==e.chartTimelineType()?e.chartTimelineType():e.previousChartOptions.chartTimelineType,chartSorting:void 0!==e.chartSorting()?e.chartSorting():e.previousChartOptions.chartSorting,chartScatterGroup:void 0!==e.chartScatterGroup()?e.chartScatterGroup():e.previousChartOptions.chartScatterGroup,chartScatterSize:void 0!==e.chartScatterSize()?e.chartScatterSize():e.previousChartOptions.chartScatterSize}},r.openNotebook=function(e,t,a,s){var n=new o.a.Deferred;return o.a.get("/desktop/api2/doc/",{uuid:e,data:!0,dependencies:!0},function(e){if(0==e.status){e.data.dependents=e.dependents,e.data.can_write=e.user_perms.can_write;var i=e.data;r.loadNotebook(i,t),void 0!==a||r.isNotificationManager()||(r.editorMode()?(r.editorType(e.document.type.substring("query-".length)),c.default.publish("active.snippet.type.changed",r.editorType()),r.isHue4()?r.changeURL(r.URLS.hue4+"?editor="+e.document.id+"&type="+r.editorType()):r.changeURL((r.isMobile()?r.URLS.editorMobile:r.URLS.editor)+"?editor="+e.document.id+"&type="+r.editorType())):r.isHue4()?r.changeURL(r.URLS.hue4_notebook+"?notebook="+e.document.id):r.changeURL(r.URLS.notebook+"?notebook="+e.document.id)),void 0!==s&&s(),n.resolve()}else o()(document).trigger("error",e.message),n.reject(),r.newNotebook()}),n.promise()},r.newNotebook=function(e,t,s){c.default.publish("active.snippet.type.changed",e),o.a.post("/notebook/api/create_notebook",{type:e||a.editor_type,directory_uuid:window.location.getParameter("directory_uuid")},function(a){if(r.loadNotebook(a.notebook),r.editorMode()&&!r.isNotificationManager()){var o=r.selectedNotebook().newSnippet(r.editorType());s&&["queryHistory","savedQueries","queryBuilderTab"].indexOf(s)>-1&&o.currentQueryTab(s),c.default.publish("detach.scrolls",r.selectedNotebook().snippets()[0]),""===window.location.getParameter("type")&&d.default.changeURLParameter("type",r.editorType()),c.default.publish("active.snippet.type.changed",e)}null!=t&&t()})},r.saveNotebook=function(){r.selectedNotebook().save()},r.saveAsNotebook=function(){r.selectedNotebook().id(null),r.selectedNotebook().uuid(d.default.UUID()),r.selectedNotebook().parentSavedQueryUuid(null),r.selectedNotebook().save(function(){c.default.publish("assist.document.refresh")})},r.showContextPopover=function(e,t){var a=o()(t.target&&"A"!==t.target.nodeName?t.target.parentElement:t.target),s=a.offset();c.default.publish("context.popover.show",{data:{type:"catalogEntry",catalogEntry:e.catalogEntry},onSampleClick:e.value,showInAssistEnabled:!0,sourceType:r.editorType(),orientation:"bottom",defaultDatabase:"default",pinEnabled:!1,source:{element:t.target,left:s.left,top:s.top-3,right:s.left+a.width()+1,bottom:s.top+a.height()-3}})}}},"./desktop/core/src/desktop/js/ext/bootstrap-datepicker.min.js":
/*!*********************************************************************!*\
  !*** ./desktop/core/src/desktop/js/ext/bootstrap-datepicker.min.js ***!
  \*********************************************************************/
/*! no exports provided */function(e,t,a){"use strict";a.r(t);var s=a(/*! jquery */"./node_modules/jquery/dist/jquery.js");function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){var t=function(t,s){if(this.element=e(t),this.format=a.parseFormat(s.format||this.element.data("date-format")||"mm/dd/yyyy"),this.picker=e(a.template).appendTo("body").on({click:e.proxy(this.click,this),mousedown:e.proxy(this.mousedown,this)}),this.isInput=this.element.is("input"),this.component=!!this.element.is(".date")&&this.element.find(".add-on"),this.isInput?this.element.on({focus:e.proxy(this.show,this),blur:e.proxy(this.hide,this),keyup:e.proxy(this.update,this)}):this.component?this.component.on("click",e.proxy(this.show,this)):this.element.on("click",e.proxy(this.show,this)),this.minViewMode=s.minViewMode||this.element.data("date-minviewmode")||0,"string"==typeof this.minViewMode)switch(this.minViewMode){case"months":this.minViewMode=1;break;case"years":this.minViewMode=2;break;default:this.minViewMode=0}if(this.viewMode=s.viewMode||this.element.data("date-viewmode")||0,"string"==typeof this.viewMode)switch(this.viewMode){case"months":this.viewMode=1;break;case"years":this.viewMode=2;break;default:this.viewMode=0}this.startViewMode=this.viewMode,this.weekStart=s.weekStart||this.element.data("date-weekstart")||0,this.weekEnd=0===this.weekStart?6:this.weekStart-1,this.fillDow(),this.fillMonths(),this.update(),this.showMode()};t.prototype={constructor:t,show:function(t){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight(),this.place(),e(window).on("resize",e.proxy(this.place,this)),t&&(t.stopPropagation(),t.preventDefault()),this.isInput||e(document).on("mousedown",e.proxy(this.hide,this)),this.element.trigger({type:"show",date:this.date})},hide:function(){this.picker.hide(),e(window).off("resize",this.place),this.viewMode=this.startViewMode,this.showMode(),this.isInput||e(document).off("mousedown",this.hide),this.set(),this.element.trigger({type:"hide",date:this.date})},set:function(){var e=a.formatDate(this.date,this.format);this.isInput?this.element.prop("value",e):(this.component&&this.element.find("input").prop("value",e),this.element.data("date",e))},setValue:function(e){this.date="string"==typeof e?a.parseDate(e,this.format):new Date(e),this.set(),this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0),this.fill()},place:function(){var e=this.component?this.component.offset():this.element.offset();this.picker.css({top:e.top+this.height,left:e.left})},update:function(e){this.date=a.parseDate("string"==typeof e?e:this.isInput?this.element.prop("value"):this.element.data("date"),this.format),this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0),this.fill()},fillDow:function(){for(var e=this.weekStart,t="<tr>";e<this.weekStart+7;)t+='<th class="dow">'+a.dates.daysMin[e++%7]+"</th>";t+="</tr>",this.picker.find(".datepicker-days thead").append(t)},fillMonths:function(){for(var e="",t=0;t<12;)e+='<span class="month">'+a.dates.monthsShort[t++]+"</span>";this.picker.find(".datepicker-months td").append(e)},fill:function(){var e=new Date(this.viewDate),t=e.getFullYear(),s=e.getMonth(),o=this.date.valueOf();this.picker.find(".datepicker-days th:eq(1)").text(a.dates.months[s]+" "+t);var n=new Date(t,s-1,28,0,0,0,0),i=a.getDaysInMonth(n.getFullYear(),n.getMonth());n.setDate(i),n.setDate(i-(n.getDay()-this.weekStart+7)%7);var r,l=new Date(n);for(l.setDate(l.getDate()+42),l=l.valueOf(),html=[];n.valueOf()<l;)n.getDay()===this.weekStart&&html.push("<tr>"),r="",n.getMonth()<s?r+=" old":n.getMonth()>s&&(r+=" new"),n.valueOf()===o&&(r+=" active"),html.push('<td class="day'+r+'">'+n.getDate()+"</td>"),n.getDay()===this.weekEnd&&html.push("</tr>"),n.setDate(n.getDate()+1);this.picker.find(".datepicker-days tbody").empty().append(html.join(""));var u=this.date.getFullYear(),c=this.picker.find(".datepicker-months").find("th:eq(1)").text(t).end().find("span").removeClass("active");u===t&&c.eq(this.date.getMonth()).addClass("active"),html="",t=10*parseInt(t/10,10);var d=this.picker.find(".datepicker-years").find("th:eq(1)").text(t+"-"+(t+9)).end().find("td");t-=1;for(var p=-1;p<11;p++)html+='<span class="year'+(-1===p||10===p?" old":"")+(u===t?" active":"")+'">'+t+"</span>",t+=1;d.html(html)},click:function(t){t.stopPropagation(),t.preventDefault();var s=e(t.target).closest("span, td, th");if(1===s.length)switch(s[0].nodeName.toLowerCase()){case"th":switch(s[0].className){case"switch":this.showMode(1);break;case"prev":case"next":this.viewDate["set"+a.modes[this.viewMode].navFnc].call(this.viewDate,this.viewDate["get"+a.modes[this.viewMode].navFnc].call(this.viewDate)+a.modes[this.viewMode].navStep*("prev"===s[0].className?-1:1)),this.fill(),this.set()}break;case"span":if(s.is(".month")){var o=s.parent().find("span").index(s);this.viewDate.setMonth(o)}else{var n=parseInt(s.text(),10)||0;this.viewDate.setFullYear(n)}0!==this.viewMode&&(this.date=new Date(this.viewDate),this.element.trigger({type:"changeDate",date:this.date,viewMode:a.modes[this.viewMode].clsName})),this.showMode(-1),this.fill(),this.set();break;case"td":if(s.is(".day")){var i=parseInt(s.text(),10)||1;o=this.viewDate.getMonth();s.is(".old")?o-=1:s.is(".new")&&(o+=1);n=this.viewDate.getFullYear();this.date=new Date(n,o,i,0,0,0,0),this.viewDate=new Date(n,o,Math.min(28,i),0,0,0,0),this.fill(),this.set(),this.element.trigger({type:"changeDate",date:this.date,viewMode:a.modes[this.viewMode].clsName})}}},mousedown:function(e){e.stopPropagation(),e.preventDefault()},showMode:function(e){e&&(this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+e))),this.picker.find(">div").hide().filter(".datepicker-"+a.modes[this.viewMode].clsName).show()}},e.fn.datepicker=function(a,s){return this.each(function(){var n=e(this),i=n.data("datepicker"),r="object"==o(a)&&a;i||n.data("datepicker",i=new t(this,e.extend({},e.fn.datepicker.defaults,r))),"string"==typeof a&&i[a](s)})},e.fn.datepicker.defaults={},e.fn.datepicker.Constructor=t;var a={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],dates:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},isLeapYear:function(e){return e%4==0&&e%100!=0||e%400==0},getDaysInMonth:function(e,t){return[31,a.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},parseFormat:function(e){var t=e.match(/[.\/\-\s].*?/),a=e.split(/\W+/);if(!t||!a||0===a.length)throw new Error("Invalid date format.");return{separator:t,parts:a}},parseDate:function(e,t){var a,s=e.split(t.separator);if((e=new Date).setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),s.length===t.parts.length)for(var o=0,n=t.parts.length;o<n;o++)switch(a=parseInt(s[o],10)||1,t.parts[o]){case"dd":case"d":e.setDate(a);break;case"mm":case"m":e.setMonth(a-1);break;case"yy":e.setFullYear(2e3+a);break;case"yyyy":e.setFullYear(a)}return e},formatDate:function(e,t){var a={d:e.getDate(),m:e.getMonth()+1,yy:e.getFullYear().toString().substring(2),yyyy:e.getFullYear()};a.dd=(a.d<10?"0":"")+a.d,a.mm=(a.m<10?"0":"")+a.m;e=[];for(var s=0,o=t.parts.length;s<o;s++)e.push(a[t.parts[s]]);return e.join(t.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};a.template='<div class="datepicker dropdown-menu"><div class="datepicker-days"><table class=" table-condensed">'+a.headTemplate+'<tbody></tbody></table></div><div class="datepicker-months"><table class="table-condensed">'+a.headTemplate+a.contTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+a.headTemplate+a.contTemplate+"</table></div></div>"}(a.n(s).a)},"./desktop/core/src/desktop/js/jquery/plugins/jquery.hdfstree.js":
/*!***********************************************************************!*\
  !*** ./desktop/core/src/desktop/js/jquery/plugins/jquery.hdfstree.js ***!
  \***********************************************************************/
/*! no exports provided */function(e,t,a){"use strict";a.r(t);var s=a(/*! jquery */"./node_modules/jquery/dist/jquery.js"),o=a.n(s),n=a(/*! ../../utils/hueUtils */"./desktop/core/src/desktop/js/utils/hueUtils.js"),i=window.$||o.a,r="jHueHdfsTree",l={home:"",initialPath:"/",isS3:!1,withTopPadding:!0,onPathChange:function(){},createFolder:!0,labels:{CREATE_FOLDER:"Create folder",FOLDER_NAME:"Folder name",CANCEL:"Cancel",HOME:"Home"}};function u(e,t){this.element=e,this.options=i.extend({},l,t),this.options.labels=i.extend({},l.labels,HUE_I18n.jHueHdfsTree,t?t.labels:{}),this._defaults=l,this._name=r,this.lastPath="",this.previousPath="",this.init()}u.prototype.init=function(e){var t=this;void 0!==e&&(t.options.initialPath=e);var a,s=i(t.element);s.empty(),s.addClass("jHueHdfsTree"),""!=t.options.home&&(a=i("<a>").html('<i class="fa fa-home"></i> '+t.options.labels.HOME).click(function(){var e=t.options.home;t.options.onPathChange(e),t.lastPath=e,o.find("a").removeClass("selected");for(var a=[],s=/\//g;null!=(match=s.exec(e));)a.push(e.substr(0,match.index));a.push(e),d({paths:a,scroll:!0})})).css({cursor:"pointer",position:"fixed","padding-bottom":"4px","font-size":"16px","border-bottom":"1px solid #FFF","background-color":"#FFF",width:560-n.default.scrollbarWidth()+"px"});var o=i("<ul>").addClass("content unstyled").html('<li><a class="pointer"><i class="fa fa-folder-open-o"></i> /</a></li>');t.options.withTopPadding&&o.css("padding-top","30px"),""!=t.options.home&&(a.appendTo(s),s.parent().on("scroll",function(){s.parent().scrollTop()>0?a.css({"border-bottom":"1px solid #EEE"}):a.css({"border-bottom":"1px solid #FFF"})})),o.appendTo(s),o.find("a").on("click",function(){t.options.onPathChange("/"),o.find("a").removeClass("selected"),o.find("a:eq(0)").addClass("selected")}),i("<ul>").addClass("content unstyled").attr("data-path","__JHUEHDFSTREE__ROOT__").attr("data-loaded","true").appendTo(o.find("li"));var r="/filebrowser/view=";function l(e){return e.replace(/\'/gi,"\\'")}function c(e){return 0==e.indexOf("/")?e.substr(1):e}function d(e){var a=r,n="";if(null!=e.paths&&e.paths.length>0){var u=e.paths.shift();n=t.options.isS3?u:""!=u?u:"/"}else n=null!=e.leaf?e.leaf:"/";a+=n,i.getJSON(a+"?pagesize=1000&format=json",function(a){if([],null==a.error){var r=t.options.isS3?n.substr(5):n,u=""!=r?c(r):"__JHUEHDFSTREE__ROOT__";if(s.find("[data-path='"+l(u)+"']").attr("data-loaded",!0),s.find("[data-path='"+l(u)+"']").siblings("a").find(".fa-folder-o").removeClass("fa-folder-o").addClass("fa-folder-open-o"),o.find("a").removeClass("selected"),s.find("[data-path='"+l(u)+"']").siblings("a").addClass("selected"),e.scroll&&s.parent().scrollTop(s.find("[data-path='"+l(u)+"']").siblings("a").position().top+s.parent().scrollTop()-30),i(a.files).each(function(e,a){if("."!=a.name&&".."!=a.name&&"dir"==a.type){var n=a.path,r=t.options.isS3?n.substr(5):n,u=l(r);if(0==s.find("[data-path='"+c(u)+"']").length){var p=i("<li>").html('<a class="pointer"><i class="fa fa-folder-o"></i> '+a.name+'</a><ul class="content unstyled" data-path="'+c(u)+'" data-loaded="false"></ul>'),h=r.substr(0,r.lastIndexOf("/"));""==h&&(h="__JHUEHDFSTREE__ROOT__"),h=c(h),p.appendTo(s.find("[data-path='"+l(h)+"']")),p.find("a").on("click",function(){t.options.onPathChange(n),t.lastPath=n,o.find("a").removeClass("selected"),p.find("a:eq(0)").addClass("selected"),"false"==p.find(".content").attr("data-loaded")?d({leaf:n,scroll:!1}):p.find(".content").is(":visible")?p.find(".content").hide():p.find(".content").show()})}}}),t.options.createFolder){var p=t.options.isS3?n.substr(5):n,h=i("<li>").html('<a class="pointer"><i class="fa fa-plus-square-o"></i> '+t.options.labels.CREATE_FOLDER+"</a>");h.appendTo(s.find("[data-path='"+c(l(p))+"']"));var m=i("<form>").css("margin-top","10px").addClass("form-inline");m.hide();var b=i("<input>").attr("type","text").attr("placeholder",t.options.labels.FOLDER_NAME).appendTo(m);i("<span> </span>").appendTo(m);var f=i("<input>").attr("type","button").attr("value",t.options.labels.CREATE_FOLDER).addClass("btn primary").appendTo(m);i("<span> </span>").appendTo(m),i("<input>").attr("type","button").attr("value",t.options.labels.CANCEL).addClass("btn").appendTo(m).click(function(){m.slideUp()}),f.click(function(){i.ajax({type:"POST",url:"/filebrowser/mkdir",data:{name:b.val(),path:n},beforeSend:function(e){e.setRequestHeader("X-Requested-With","Hue")},success:function(e,a){if("success"==a){m.slideUp();var s=n+"/"+b.val();t.init(s),t.options.onPathChange(s)}}})}),m.appendTo(s.find("[data-path='"+c(l(p))+"']")),h.find("a").on("click",function(){m.slideDown()})}null!=e.paths&&e.paths.length>0&&d({paths:e.paths,scroll:e.scroll})}else i.jHueNotify.error(a.error)})}u.prototype.showHdfsLeaf=d;var p=[];if("/"!=t.options.initialPath){for(var h=/\//g;null!=(match=h.exec(t.options.initialPath));)p.push(t.options.initialPath.substr(0,match.index));p.push(t.options.initialPath)}t.options.isS3&&(p.shift(),p[0]="s3a://"),d({paths:p})},u.prototype.setOptions=function(e){this.options=i.extend({},l,e)},i.fn[r]=function(e){return this.each(function(){i.data(this,"plugin_"+r)||i.data(this,"plugin_"+r,new u(this,e))})},i[r]=function(e){"undefined"!=typeof console&&console.warn("$(elem).jHueHdfsTree() is a preferred call method."),i(e.element).jHueHdfsTree(e)}},1:
/*!*********************************************************************!*\
  !*** multi ./desktop/core/src/desktop/js/apps/notebook/notebook.js ***!
  \*********************************************************************/
/*! no static exports found */function(e,t,a){e.exports=a(/*! ./desktop/core/src/desktop/js/apps/notebook/notebook.js */"./desktop/core/src/desktop/js/apps/notebook/notebook.js")}});
//# sourceMappingURL=notebook-bundle-c73ead5c4cc870298ae9.js.map